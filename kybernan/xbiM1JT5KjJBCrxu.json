{
  "updatedAt": "2025-12-04T10:59:19.050Z",
  "createdAt": "2025-11-26T10:17:15.840Z",
  "id": "xbiM1JT5KjJBCrxu",
  "name": "PRINCIPAL - ARQUIVADOR",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "6ff257a0-6494-492b-af31-5214a9bd20a1",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -4560,
        128
      ],
      "id": "02e65664-256c-4dbb-9aca-7f8cb2fe9832",
      "name": "Webhook",
      "webhookId": "6ff257a0-6494-492b-af31-5214a9bd20a1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "16ffaaef-fe33-426d-a0ff-e2dac2b106e9",
              "leftValue": "={{ $json.body.message.isGroup }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3648,
        128
      ],
      "id": "27f5f0f3-677b-404d-b04a-fd415490c8e0",
      "name": "isGroup",
      "executeOnce": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1d8f7b82-de27-4f28-afe4-9f073754da5b",
                    "leftValue": "={{ $('Dados de Entrada').item.json.TipoDeMensagem }}",
                    "rightValue": "ExtendedTextMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ExtendedTextMessage"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8e75be5f-38f7-4db9-8ebe-c2f0e4580de1",
                    "leftValue": "={{ $('Dados de Entrada').item.json.TipoDeMensagem }}",
                    "rightValue": "=Conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Conversation"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Dados de Entrada').item.json.TipoDeMensagem }}",
                    "rightValue": "AudioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e9de78c4-def0-4385-92ae-f3d8db4668ef"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "AudioMessage"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6dc571f3-1d8c-4784-8cfa-d29f807666f7",
                    "leftValue": "={{ $('Dados de Entrada').item.json.TipoDeMensagem }}",
                    "rightValue": "ImageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ImageMessage"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7a88511a-7a3c-442d-bad5-fc9aa48d5a18",
                    "leftValue": "={{ $('Dados de Entrada').item.json.TipoDeMensagem }}",
                    "rightValue": "DocumentMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "DocumentMessage"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -2144,
        80
      ],
      "id": "271e1181-ddcd-4143-a6a6-79e35c53c17b",
      "name": "tipoMsg"
    },
    {
      "parameters": {
        "operation": "rowNotExists",
        "dataTableId": {
          "__rl": true,
          "value": "TvERETBAGi000bZb",
          "mode": "list",
          "cachedResultName": "DadosClienteKybernan",
          "cachedResultUrl": "/projects/72MghKyBe7pL4bex/datatables/TvERETBAGi000bZb"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "IdGroup",
              "keyValue": "={{ $json.body.message.chatid }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -2896,
        48
      ],
      "id": "e7150fda-84b5-4a1d-ace4-d2d974f070a7",
      "name": "ExisteGrupoTabela False",
      "executeOnce": true
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "TvERETBAGi000bZb",
          "mode": "list",
          "cachedResultName": "DadosClienteKybernan",
          "cachedResultUrl": "/projects/72MghKyBe7pL4bex/datatables/TvERETBAGi000bZb"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "IdGroup",
              "keyValue": "={{ $('Dados de Entrada').item.json.body.message.chatid }}"
            },
            {
              "keyName": "phone1",
              "keyValue": "={{ $('Dados de Entrada').item.json.body.message.sender_pn }}"
            },
            {
              "keyName": "phone2",
              "keyValue": "={{ $('Dados de Entrada').item.json.body.message.sender_pn }}"
            },
            {
              "keyName": "phone3",
              "keyValue": "={{ $('Dados de Entrada').item.json.body.message.sender_pn }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -2896,
        256
      ],
      "id": "c4e81850-1e79-4f18-89b6-c46f34c3aaa3",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "TvERETBAGi000bZb",
          "mode": "list",
          "cachedResultName": "DadosClienteKybernan",
          "cachedResultUrl": "/projects/72MghKyBe7pL4bex/datatables/TvERETBAGi000bZb"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "IdGroup": "={{ $('Dados de Entrada').item.json.body.message.chatid }}",
            "NomeGrupo": "={{ $('Dados de Entrada').item.json.Nome }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "NomeGrupo",
              "displayName": "NomeGrupo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "IdGroup",
              "displayName": "IdGroup",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "phone1",
              "displayName": "phone1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "phone2",
              "displayName": "phone2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "phone3",
              "displayName": "phone3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Folder",
              "displayName": "Folder",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "apiERP",
              "displayName": "apiERP",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "ERP",
              "displayName": "ERP",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -2704,
        48
      ],
      "id": "fbb4a44a-71e6-4f63-a7f9-95e9c4c308e6",
      "name": "Insere Novo Row"
    },
    {
      "parameters": {
        "content": "## BANCO DE DADOS\n\ntratamento de BD para identificar usuário e pasta correta, etc..\n",
        "height": 480,
        "width": 656,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3184,
        -64
      ],
      "id": "e2b4180f-4460-443c-a34d-979ffd64ab8b",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9d48431-6205-4d71-9d24-346dfe880a25",
              "name": "IdGroup",
              "value": "={{ $json.IdGroup }}",
              "type": "string"
            },
            {
              "id": "46b09227-842e-44df-95f7-4819cc47f958",
              "name": "phone1",
              "value": "={{ $json.phone1 }}",
              "type": "string"
            },
            {
              "id": "91d9c47f-3e9a-4344-86e6-f5124490957f",
              "name": "phone2",
              "value": "={{ $json.phone2 }}",
              "type": "string"
            },
            {
              "id": "0c9bc12c-ca1e-4f6c-ba7b-c33a6fa84fe6",
              "name": "phone3",
              "value": "={{ $json.phone3 }}",
              "type": "string"
            },
            {
              "id": "4b1803fd-3a6e-463d-b63e-8b37605cdc9e",
              "name": "email",
              "value": "={{ $json.email }}",
              "type": "string"
            },
            {
              "id": "a8310a6c-4a6f-4151-878f-edf87ef8f06e",
              "name": "Folder",
              "value": "={{ $json.Folder }}",
              "type": "string"
            },
            {
              "id": "f6f759e7-b7cf-4081-93d3-362cf3b2ffd8",
              "name": "apiERP",
              "value": "={{ $json.apiERP }}",
              "type": "string"
            },
            {
              "id": "61b97bff-04e1-4870-8c6e-0286ac545ed1",
              "name": "ERP",
              "value": "={{ $json.ERP }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2688,
        256
      ],
      "id": "c7008e17-9448-4747-8b4e-a3e3692e6e56",
      "name": "DADOS USUÁRIO"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "name contains 'controle'",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.Folder }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {
          "fields": [
            "id",
            "name"
          ]
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3136,
        320
      ],
      "id": "7288f54b-101a-47c9-8c92-38005813c165",
      "name": "encontraControle",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "=name contains '{{ $('Loop Over Items').item.json.ANO }}'",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {
          "fields": [
            "id",
            "name"
          ]
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3424,
        320
      ],
      "id": "a83bd865-f0b3-4592-b765-90424dd8b369",
      "name": "encontraAno",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "=name contains '{{ $('Loop Over Items').item.json.MES }}'",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {
          "fields": [
            "id",
            "name"
          ]
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4288,
        304
      ],
      "id": "63b143aa-9d5a-41c1-9f3b-e749c16a1670",
      "name": "encontraMês",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "searchMethod": "query",
        "queryString": "=name contains '{{ $('Loop Over Items').item.json.DATA }}'",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {
          "fields": [
            "id",
            "name"
          ]
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5120,
        288
      ],
      "id": "163697c2-7261-42ea-b487-6c963a5b05e5",
      "name": "encontraDia",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ea5837ba-5aa9-42b0-bfda-da89345ec33e",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        5408,
        288
      ],
      "id": "cce7d4c9-00e2-47a1-9571-5fe4675dbfee",
      "name": "PastaDiaExiste?"
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -416,
        1344
      ],
      "id": "1d71cb53-dd9b-475e-9230-5a186ec0a31d",
      "name": "Extract from File"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://kybernan.uazapi.com/message/download",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json"
            },
            {
              "name": "token",
              "value": "4d8e979d-0339-417a-89c6-9e56bc0cead7"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "={{ $('Dados de Entrada').item.json.body.message.messageid }}"
            },
            {
              "name": "return_base64",
              "value": "true"
            },
            {
              "name": "generate_mp3",
              "value": "false"
            },
            {
              "name": "transcribe",
              "value": "false"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1024,
        -320
      ],
      "id": "023fa18a-cac6-4e2a-8dc2-78bd53dc51be",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64Data",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -816,
        -320
      ],
      "id": "2351b7f9-ae4d-456f-a70d-6c9e8c67460b",
      "name": "Convert to File1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://kybernan.uazapi.com/message/download",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json"
            },
            {
              "name": "token",
              "value": "4d8e979d-0339-417a-89c6-9e56bc0cead7"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "={{ $('Dados de Entrada').item.json.body.message.messageid }}"
            },
            {
              "name": "return_base64",
              "value": "true"
            },
            {
              "name": "generate_mp3",
              "value": "false"
            },
            {
              "name": "transcribe",
              "value": "false"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1904,
        720
      ],
      "id": "da62ecd9-2e16-42b7-b050-ef61e44eb982",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64Data",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -1696,
        736
      ],
      "id": "f548f8d3-b350-4c20-a701-1b74efd7c4ff",
      "name": "Convert to File2"
    },
    {
      "parameters": {
        "inputText": "={{ $json.text }}",
        "categories": {
          "categories": [
            {
              "category": "aPagar",
              "description": "BOLETOS, IMPOSTOS, GUIAS, FGTS, DARE,ETC "
            },
            {
              "category": "notaFiscal",
              "description": "NOTA FISCAL E CUPOM FISCAL"
            },
            {
              "category": "holerites",
              "description": "HOLERITES "
            },
            {
              "category": "recibos",
              "description": "RECIBOS"
            },
            {
              "category": "comprovantePagamento",
              "description": "comprovante de pagamento de boletos"
            },
            {
              "category": "cheque",
              "description": "CHEQUE "
            },
            {
              "category": "comprovantePixTransferencia",
              "description": "comprovante de transferência ou pix"
            },
            {
              "category": "pedidoDeCompra",
              "description": "Pedido de compra"
            }
          ]
        },
        "options": {
          "multiClass": true,
          "fallback": "other",
          "systemPromptTemplate": "=Atue como um classificador de documentos financeiros. Analise o texto e defina a categoria correta entre as opções: {categories}.\n\nRegras de diferenciação estrita:\n1. Se for uma cobrança ou boleto (dívida aberta), use \"aPagar\".\n2. Se for prova de pagamento de boleto, use \"comprovantePagamento\".\n3. Se for transferência bancária (Pix/TED), use \"comprovantePixTransferencia\".\n\n\n## Importante\n- Alguns documentos podem ter contas a pagar (boletos) e nota fiscal (NF) por exemplo, se receber nota fiscal com boleto juntos então classificar ambos como true, apenas aceitar multiplos caminhos quando for nota e boleto ou pedido de compra com data de conta a pagar, outros casos precisa ser 1 classificação apenas\n- Se for só um boleto então classificar apenas como aPagar, para boletos, não classificar para NF, só classificar para ambos se realmente tiver amboras, NF e Boleto.\n- Se for só um boleto classifique apenas como boleto, não como outros ou nota fiscal",
          "enableAutoFixing": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1.1,
      "position": [
        464,
        1008
      ],
      "id": "9e05b0c8-d3f2-49a0-a84c-bace19459f3e",
      "name": "Text Classifier"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cc623d92-90a9-4c53-a977-960b80305e27",
              "name": "text",
              "value": "={{ $json.text || $json['0'].content[0].text || $json['0'].content[0].text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        0,
        1184
      ],
      "id": "4ba8a991-1a84-40c6-aacd-10b6f73f032b",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.ilovepdf.com/v1/auth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "public_key",
              "value": "project_public_6e99f304b7b0f32194a219829ae0da16_1TjZUf8d65af7f20c2bb97ef86ef511d10f50"
            },
            {
              "name": "secret_key",
              "value": "secret_key_2b4e29231feda1bacf76a575828fdba7_8l_xca3740dd3253a8b56bbc5e54cd6c1664f"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        528,
        -208
      ],
      "id": "7c480619-edba-46d5-adfa-a4d7ca0f9012",
      "name": "Gerar JWT"
    },
    {
      "parameters": {
        "url": "https://api.ilovepdf.com/v1/start/pdfocr",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $json.token }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        720,
        -208
      ],
      "id": "a159f4c6-0a56-4f85-a6d1-10b8dcad4f12",
      "name": "CriaTarefaOcr"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $json.server }}/v1/upload",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Gerar JWT').item.json.token }}"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "task",
              "value": "={{ $json.task }}"
            },
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1184,
        -208
      ],
      "id": "feb10a82-73c9-4f41-a429-449f70cc61d7",
      "name": "UploadPdf"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://{{ $('CriaTarefaOcr').item.json.server }}/v1/process",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Gerar JWT').item.json.token }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"task\": \"{{ $('CriaTarefaOcr').item.json.task }}\",\n  \"tool\": \"pdfocr\",\n  \"files\": [\n    {\n      \"server_filename\": \"{{ $json.server_filename }}\",\n      \"filename\": \"file\"\n    }\n  ],\n  \"ocr_languages\": [\n    \"por\"\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1344,
        -208
      ],
      "id": "7b36388b-33ab-4225-997e-aff2a0bf4970",
      "name": "ProcessPdfToOcr"
    },
    {
      "parameters": {
        "url": "=https://{{ $('CriaTarefaOcr').item.json.server }}/v1/download/{{ $('CriaTarefaOcr').item.json.task }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Gerar JWT').item.json.token }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1520,
        -112
      ],
      "id": "3b4dec12-071f-4d72-83b9-701d00d7286e",
      "name": "DownloadPdfOcr"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        960,
        -320
      ],
      "id": "25116963-8a16-4f85-b974-b481173f9cee",
      "name": "Merge"
    },
    {
      "parameters": {
        "name": "arquivo",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1kNfMrXJtz3jlu9lXqhDxa1nXuLa4b0v0",
          "mode": "list",
          "cachedResultName": "ARQUIVOS RECEBIDOS KYBERNAN TESTE",
          "cachedResultUrl": "https://drive.google.com/drive/folders/1kNfMrXJtz3jlu9lXqhDxa1nXuLa4b0v0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -400,
        1136
      ],
      "id": "9bc951fe-d887-4954-b199-363c66a2d85b",
      "name": "Upload file2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=Analise o texto financeiro fornecido e extraia os dados para retornar EXATAMENTE o seguinte JSON:\n\n{\n  \"DATA\": \"Dia com 2 dígitos (DD)\",\n  \"MES\": \"Mês abreviado em maiúsculo (JAN, FEV, MAR, ABR, MAI, JUN, JUL, AGO, SET, OUT, NOV, DEZ)\",\n  \"ANO\": \"Ano com 4 dígitos (AAAA)\",\n  \"NOME_ARQUIVO\": \"DIA.MÊS - NOME_DO_FORNECEDOR\",\n  \"CODIGO_BARRAS\": \"número completo exato do código só números\"\n}\n\nRegras:\n1. Em \"NOME_ARQUIVO\", use o número do mês (ex: 01, 02) e o nome da empresa que irá receber os valores, ou seja, nome do beneficiário em maiúsculo.\n2. Priorize a data de VENCIMENTO encontrada.\n3. Não inclua markdown, apenas o JSON puro.\n4. Exemplo para NOME_ARQUIVO: \"10.11 - ALIBRA\" (Sendo 10 o DIA e 11 o MÊS numérico)\n5. Se tiver nota fiscal com boletos, ignore a nota fiscal e extraia os dados apenas dos boletos\n6. Se a data de vencimento for a mesma, não extrair mais de uma vez os dados, extrair 1 vez apenas e neste caso o nome do arquivo coloque \"DD.MM - DIVERSOS FORNECEDORES\" se houver mais de um na mesma data.\n7. Sempre que houver código de barras de um determinado boleto, também extraia o valor, só números, tenha certeza de que está informando o código inteiro e o número está correto.\n\nAnalise o texto financeiro fornecido e extraia os dados para retornar EXATAMENTE um ARRAY JSON contendo um ou mais objetos, no seguinte formato.\n\nSe for encontrada apenas UMA data de vencimento/pagamento (indicando um único boleto ou conta), o retorno DEVE ser um array contendo um único objeto.\nSe for encontrada MAIS DE UMA data de vencimento/pagamento (indicando múltiplos boletos ou contas), o retorno DEVE ser um array JSON contendo um objeto para cada boleto/conta individual.\n\nEstrutura do Objeto (dentro do Array):\n{\n  \"DATA\": \"Dia com 2 dígitos (DD)\",\n  \"MES\": \"Mês abreviado em maiúsculo (JAN, FEV, MAR, ABR, MAI, JUN, JUL, AGO, SET, OUT, NOV, DEZ)\",\n  \"ANO\": \"Ano com 4 dígitos (AAAA)\",\n  \"NOME_ARQUIVO\": \"DIA.MÊS_NUMÉRICO - NOME_DO_FORNECEDOR\",\n  \"CODIGO_BARRAS\": \"número completo exato do código só números\"\n}\n\nRegras:\n\nEm \"NOME_ARQUIVO\", use o número do mês com dois dígitos (ex: 01, 02, ..., 12) e o nome da empresa que irá receber os valores, ou seja, nome do beneficiário em maiúsculo.\n\nPriorize a data de VENCIMENTO encontrada.\n\nExemplo para NOME_ARQUIVO: \"10.11 - ALIBRA\" (Sendo 10 o DIA e 11 o MÊS numérico).\n\nExemplo de Saída (Múltiplos Boletos):\n[\n{\n\"DATA\": \"10\",\n\"MES\": \"NOV\",\n\"ANO\": \"2025\",\n\"NOME_ARQUIVO\": \"10.11 - ALIBRA\",\n\"CODIGO_BARRAS\": \"número completo exato do código só números\"\n},\n{\n\"DATA\": \"17\",\n\"MES\": \"NOV\",\n\"ANO\": \"2025\",\n\"NOME_ARQUIVO\": \"17.11 - ALIBRA\",\n\"CODIGO_BARRAS\": \"número completo exato do código só números\"\n}\n]\n\nExemplo de Saída (Boleto Único):\n[\n{\n\"DATA\": \"15\",\n\"MES\": \"SET\",\n\"ANO\": \"2025\",\n\"NOME_ARQUIVO\": \"15.09 - AGUA_LIMPA\",\n\"CODIGO_BARRAS\": \"número completo exato do código só números\"\n}\n]\n\n## RULES\n- NUNCA, JAMAIS, erre informações, tenha certeza das datas, dia, mês e ANO"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        1936,
        304
      ],
      "id": "fee0a4a4-dc7a-4c9d-8313-2cb40fef7eb0",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1",
          "mode": "list",
          "cachedResultName": "gpt-5.1"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        1920,
        544
      ],
      "id": "2eebaf89-ee86-4e10-afb7-6fd57143d3d4",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "fRrIyxCKgTlReSWb",
          "name": "Kybernan-Arquivador"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "[\n{\n\"DATA\": \"10\",\n\"MES\": \"NOV\",\n\"ANO\": \"2025\",\n\"NOME_ARQUIVO\": \"10.11 - ALIBRA\",\n\"CODIGO_BARRAS\": \"número completo exato do código só números\"\n},\n{\n\"DATA\": \"17\",\n\"MES\": \"NOV\",\n\"ANO\": \"2025\",\n\"NOME_ARQUIVO\": \"17.11 - ALIBRA\",\n\"CODIGO_BARRAS\": \"número completo exato do código só números\"\n}\n]",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        2128,
        480
      ],
      "id": "918eadd9-256b-4061-b8cc-0061a3cd26cb",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "numberInputs": 3,
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        176,
        1040
      ],
      "id": "c4438367-3efd-4b04-ae7a-a1dd06e1d31f",
      "name": "Merge1",
      "executeOnce": true
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -368,
        144
      ],
      "id": "feeecb04-34b4-4e4a-b886-013d8a5c4fce",
      "name": "Extract from File1"
    },
    {
      "parameters": {
        "content": "## Imagem para PDF",
        "height": 304,
        "width": 688,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1296,
        -400
      ],
      "id": "6bd77148-c4c2-4a94-9b49-c1bd6853e36f",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b6a152ef-f1f0-47ca-bd32-db9737dff1ae",
              "leftValue": "={{ $json.Folder }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2448,
        256
      ],
      "id": "4d4f66fe-732f-4ec1-ba67-e849af83f79b",
      "name": "temPasta"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ea5837ba-5aa9-42b0-bfda-da89345ec33e",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4576,
        304
      ],
      "id": "d585e58b-5637-4ecc-af2a-1ed8f99866fc",
      "name": "PastaDiaExiste?1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ea5837ba-5aa9-42b0-bfda-da89345ec33e",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3696,
        320
      ],
      "id": "036454ae-d3fc-4ee1-916b-8d1c047f9638",
      "name": "PastaDiaExiste?2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d0250d2a-d792-4061-a12e-e16b7a22cb47",
              "name": "Nome",
              "value": "={{ $json.body.chat.name }}",
              "type": "string"
            },
            {
              "id": "ad1db2aa-736d-4164-9683-87654e150161",
              "name": "body.message.senderName",
              "value": "={{ $json.body.message.senderName }}",
              "type": "string"
            },
            {
              "id": "9c67e34d-811b-4ff2-87ad-6075a508463b",
              "name": "TipoDeMensagem",
              "value": "={{ $json.body.message.messageType }}",
              "type": "string"
            },
            {
              "id": "cb9a1539-beeb-407b-a17d-23985944eed0",
              "name": "body.message.content.URL",
              "value": "={{ $json.body.message.content.URL }}",
              "type": "string"
            },
            {
              "id": "1d589f28-545f-455a-995b-15fe80092f32",
              "name": "body.message.isGroup",
              "value": "={{ $json.body.message.isGroup }}",
              "type": "boolean"
            },
            {
              "id": "2fcecf85-6540-41a7-987f-bd25c45a5a8f",
              "name": "body.message.sender_pn",
              "value": "={{ $json.body.message.sender_pn ? $json.body.message.sender_pn.replace(/[^0-9]/g, '').slice(2) : null }}",
              "type": "string"
            },
            {
              "id": "2d522b05-d083-432a-af3e-292a2baf080a",
              "name": "body.message.text",
              "value": "={{ $json.body.message.text }}",
              "type": "string"
            },
            {
              "id": "4159e7cd-a733-47b5-8a3d-0786c19be8cd",
              "name": "body.message.chatid",
              "value": "={{ $json.body.message.chatid }}",
              "type": "string"
            },
            {
              "id": "b9b4a916-acb6-4032-be80-0bdd78b1033f",
              "name": "body.message.messageid",
              "value": "={{ $json.body.message.messageid }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4272,
        128
      ],
      "id": "58174c50-92b5-4c4d-98bc-9adaa7f9448b",
      "name": "Dados de Entrada"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ $('Loop Over Items').item.json.ANO }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('encontraControle').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "simplifyOutput": true
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3856,
        480
      ],
      "id": "5acd9ed9-27bb-4396-9e1b-554940bd1a73",
      "name": "Cria Pasta Ano",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ $('Loop Over Items').item.json.MES }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('idPastaAno').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "simplifyOutput": true
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4720,
        496
      ],
      "id": "b8bd4d4c-b653-4c16-9ef5-2808536dd22c",
      "name": "Cria Pasta Mes",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ $('Loop Over Items').item.json.DATA }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('idPastaMes').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "simplifyOutput": true
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5616,
        480
      ],
      "id": "b511ab3a-9edd-471e-a693-897f33f00381",
      "name": "Cria Pasta Dia",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ",
          "mode": "list",
          "cachedResultName": "LOG ARQUIVOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DATA": "={{ $today.format('dd-MM-yyyy') }}",
            "HORA": "={{ $now.format('hh:mm') }}",
            "CLIENTE": "={{ $('Get row(s)').item.json.NomeGrupo }}",
            "CAMINHO QUE FOI SALVO": "=NOTAS FISCAIS",
            "LINK ARQUIVO": "={{ $('Upload file2').item.json.webViewLink }}",
            "TIPO DE ARQUIVO": "PEDIDO COMPRA"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "DATA",
              "displayName": "DATA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CLIENTE",
              "displayName": "CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO DE ARQUIVO",
              "displayName": "TIPO DE ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LINK ARQUIVO",
              "displayName": "LINK ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CAMINHO QUE FOI SALVO",
              "displayName": "CAMINHO QUE FOI SALVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1168,
        1968
      ],
      "id": "a788e0f5-192b-469f-8839-d77e39419903",
      "name": "PEDIDO COMPRA",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ",
          "mode": "list",
          "cachedResultName": "LOG ARQUIVOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DATA": "={{ $today.format('dd-MM-yyyy') }}",
            "HORA": "={{ $now.format('hh:mm') }}",
            "CLIENTE": "={{ $('Get row(s)').item.json.NomeGrupo }}",
            "CAMINHO QUE FOI SALVO": "=NOTAS FISCAIS",
            "LINK ARQUIVO": "={{ $('Upload file2').item.json.webViewLink }}",
            "TIPO DE ARQUIVO": "HOLERITES"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "DATA",
              "displayName": "DATA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CLIENTE",
              "displayName": "CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO DE ARQUIVO",
              "displayName": "TIPO DE ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LINK ARQUIVO",
              "displayName": "LINK ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CAMINHO QUE FOI SALVO",
              "displayName": "CAMINHO QUE FOI SALVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1168,
        1136
      ],
      "id": "bec0d12d-bb21-4e3a-827f-96a9d72e2783",
      "name": "HOLERITES",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ",
          "mode": "list",
          "cachedResultName": "LOG ARQUIVOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DATA": "={{ $today.format('dd-MM-yyyy') }}",
            "HORA": "={{ $now.format('hh:mm') }}",
            "CLIENTE": "={{ $('Get row(s)').item.json.NomeGrupo }}",
            "CAMINHO QUE FOI SALVO": "=NOTAS FISCAIS",
            "LINK ARQUIVO": "={{ $('Upload file2').item.json.webViewLink }}",
            "TIPO DE ARQUIVO": "RECIBOS"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "DATA",
              "displayName": "DATA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CLIENTE",
              "displayName": "CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO DE ARQUIVO",
              "displayName": "TIPO DE ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LINK ARQUIVO",
              "displayName": "LINK ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CAMINHO QUE FOI SALVO",
              "displayName": "CAMINHO QUE FOI SALVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1168,
        1296
      ],
      "id": "4f58faf7-9116-4eaf-9a0b-d2908cc31675",
      "name": "RECIBOS",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ",
          "mode": "list",
          "cachedResultName": "LOG ARQUIVOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DATA": "={{ $today.format('dd-MM-yyyy') }}",
            "HORA": "={{ $now.format('hh:mm') }}",
            "CLIENTE": "={{ $('Get row(s)').item.json.NomeGrupo }}",
            "CAMINHO QUE FOI SALVO": "=NÃO SALVO",
            "LINK ARQUIVO": "={{ $('Upload file2').item.json.webViewLink }}",
            "TIPO DE ARQUIVO": "COMPROVANTE PAGAMENTO"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "DATA",
              "displayName": "DATA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CLIENTE",
              "displayName": "CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO DE ARQUIVO",
              "displayName": "TIPO DE ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LINK ARQUIVO",
              "displayName": "LINK ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CAMINHO QUE FOI SALVO",
              "displayName": "CAMINHO QUE FOI SALVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1168,
        1456
      ],
      "id": "0128b1d7-95e2-4dd8-be43-f97c951e6e64",
      "name": "COMPROVANTE PAGAMENTO",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ",
          "mode": "list",
          "cachedResultName": "LOG ARQUIVOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DATA": "={{ $today.format('dd-MM-yyyy') }}",
            "HORA": "={{ $now.format('hh:mm') }}",
            "CLIENTE": "={{ $('Get row(s)').item.json.NomeGrupo }}",
            "CAMINHO QUE FOI SALVO": "=NOTAS FISCAIS",
            "LINK ARQUIVO": "={{ $('Upload file2').item.json.webViewLink }}",
            "TIPO DE ARQUIVO": "CHEQUES"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "DATA",
              "displayName": "DATA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CLIENTE",
              "displayName": "CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO DE ARQUIVO",
              "displayName": "TIPO DE ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LINK ARQUIVO",
              "displayName": "LINK ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CAMINHO QUE FOI SALVO",
              "displayName": "CAMINHO QUE FOI SALVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1168,
        1632
      ],
      "id": "f6e8c582-1a4d-4cbd-a7f4-d5b8f73075f6",
      "name": "CHEQUES",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ",
          "mode": "list",
          "cachedResultName": "LOG ARQUIVOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DATA": "={{ $today.format('dd-MM-yyyy') }}",
            "HORA": "={{ $now.format('hh:mm') }}",
            "CLIENTE": "={{ $('Get row(s)').item.json.NomeGrupo }}",
            "CAMINHO QUE FOI SALVO": "=NÃO SALVO",
            "LINK ARQUIVO": "={{ $('Upload file2').item.json.webViewLink }}",
            "TIPO DE ARQUIVO": "TRANSFERENCIA PIX"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "DATA",
              "displayName": "DATA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CLIENTE",
              "displayName": "CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO DE ARQUIVO",
              "displayName": "TIPO DE ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LINK ARQUIVO",
              "displayName": "LINK ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CAMINHO QUE FOI SALVO",
              "displayName": "CAMINHO QUE FOI SALVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1168,
        1792
      ],
      "id": "3eef9de4-a311-4090-b780-1e642fca1f2f",
      "name": "TRANSFERENCIA PIX",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ",
          "mode": "list",
          "cachedResultName": "LOG ARQUIVOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DATA": "={{ $today.format('dd-MM-yyyy') }}",
            "HORA": "={{ $now.format('hh:mm') }}",
            "CLIENTE": "={{ $('Get row(s)').item.json.NomeGrupo }}",
            "CAMINHO QUE FOI SALVO": "=NOTAS FISCAIS",
            "LINK ARQUIVO": "={{ $('Upload file2').item.json.webViewLink }}",
            "TIPO DE ARQUIVO": "OUTROS"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "DATA",
              "displayName": "DATA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CLIENTE",
              "displayName": "CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO DE ARQUIVO",
              "displayName": "TIPO DE ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LINK ARQUIVO",
              "displayName": "LINK ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CAMINHO QUE FOI SALVO",
              "displayName": "CAMINHO QUE FOI SALVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1168,
        2128
      ],
      "id": "1a0c29e1-8240-41e5-a7e4-f0979f4eac02",
      "name": "OUTROS",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0ca53349-4a2f-410c-9b0f-d37dbd8379fa",
              "leftValue": "={{ $('HTTP Request3').item.json.mimetype }}",
              "rightValue": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1456,
        656
      ],
      "id": "7fc622cc-02c9-4fc9-86a5-fea2e1727f78",
      "name": "excel?"
    },
    {
      "parameters": {
        "pdfName": "arquivo"
      },
      "type": "n8n-nodes-pdfkit.pdfKit",
      "typeVersion": 1,
      "position": [
        -576,
        -320
      ],
      "id": "6920d41b-fb84-4bc1-8f96-63476949304e",
      "name": "PDFKit"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bbdfcb0e-b11a-4cb9-ae83-00547a243bf0",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4000,
        304
      ],
      "id": "5fa71fde-da89-4c8d-ae7c-d6416a6e1517",
      "name": "idPastaAno"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bbdfcb0e-b11a-4cb9-ae83-00547a243bf0",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4848,
        288
      ],
      "id": "0a9a9088-44bc-4860-b70d-94417b846ee7",
      "name": "idPastaMes"
    },
    {
      "parameters": {
        "content": "## É excel?\n",
        "height": 240,
        "width": 624
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2160,
        640
      ],
      "id": "7157356b-c417-48a6-91ba-6df915f79b96",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## Excel para PDF\n",
        "height": 288,
        "width": 272,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1360,
        -48
      ],
      "id": "9f458b65-0915-4ac1-b27b-39fb7f3e3d9d",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## Puxa o texto e vê quantidade caracteres",
        "height": 240,
        "width": 432
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -656,
        64
      ],
      "id": "c364bf06-b91a-4fd7-82d0-95954a009f45",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {
          "includeBinaries": true
        }
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -384,
        752
      ],
      "id": "23d5b8ff-9511-48fe-9440-c67dc1dfc963",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "content": "## ARQUIVO PDF FINAL",
        "height": 224,
        "width": 400
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -656,
        688
      ],
      "id": "87ac175d-99db-461d-82d5-f2a376386816",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://kybernan.uazapi.com/message/download",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json"
            },
            {
              "name": "token",
              "value": "4d8e979d-0339-417a-89c6-9e56bc0cead7"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "={{ $('Dados de Entrada').item.json.body.message.messageid }}"
            },
            {
              "name": "return_base64",
              "value": "true"
            },
            {
              "name": "generate_mp3",
              "value": "false"
            },
            {
              "name": "transcribe",
              "value": "false"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -384,
        464
      ],
      "id": "deff2226-0703-40bb-b934-2c8334254ec5",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64Data",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -176,
        464
      ],
      "id": "c3e60bc5-4d76-47b7-a178-b15e257b837c",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "content": "## PDF com padrão OCR",
        "height": 224,
        "width": 672
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -656,
        400
      ],
      "id": "f250a6f8-4a7f-4e30-8601-34eec3ff019c",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://kybernan.uazapi.com/message/download",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json"
            },
            {
              "name": "token",
              "value": "4d8e979d-0339-417a-89c6-9e56bc0cead7"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "={{ $('Dados de Entrada').item.json.body.message.messageid }}"
            },
            {
              "name": "return_base64",
              "value": "true"
            },
            {
              "name": "generate_mp3",
              "value": "false"
            },
            {
              "name": "transcribe",
              "value": "false"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        128,
        -416
      ],
      "id": "1ef4c0a6-e978-4795-bd56-569e5d94a6a5",
      "name": "HTTP Request4"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64Data",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        336,
        -416
      ],
      "id": "5c2bb384-df36-4671-8d91-6407aa0f469b",
      "name": "Convert to File3"
    },
    {
      "parameters": {
        "content": "## FAZ OCR",
        "height": 512,
        "width": 1568,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -128,
        -480
      ],
      "id": "ad97d6b3-115c-44e9-9503-9022aa32e58c",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "## Junta texto, arquivo e dados",
        "height": 528,
        "width": 528
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -656,
        992
      ],
      "id": "bbbacf82-a592-42d0-bb59-d43ce181a372",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "## Classificador",
        "height": 1360,
        "width": 976
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        224,
        928
      ],
      "id": "65f438e5-747a-4e11-a0a6-0b3f8dab987f",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "content": "## Boletos",
        "height": 576,
        "width": 4512
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1648,
        208
      ],
      "id": "a04f1d7a-762b-4f4f-9010-783f4131bd8d",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ",
          "mode": "list",
          "cachedResultName": "LOG ARQUIVOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DATA": "={{ $today.format('dd-MM-yyyy') }}",
            "HORA": "={{ $now.format('hh:mm') }}",
            "CLIENTE": "={{ $('Get row(s)').item.json.NomeGrupo }}",
            "CAMINHO QUE FOI SALVO": "={{ $('Get row(s)').item.json.NomeGrupo }} / {{ $('Loop Over Items').item.json.ANO }} / {{ $('Loop Over Items').item.json.MES }} / {{ $('Loop Over Items').item.json.DATA }}",
            "LINK ARQUIVO": "=https://drive.google.com/file/d/{{ $json.id }}/view",
            "TIPO DE ARQUIVO": "BOLETO"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "DATA",
              "displayName": "DATA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CLIENTE",
              "displayName": "CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO DE ARQUIVO",
              "displayName": "TIPO DE ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LINK ARQUIVO",
              "displayName": "LINK ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CAMINHO QUE FOI SALVO",
              "displayName": "CAMINHO QUE FOI SALVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "MOTIVO DO ERRO",
              "displayName": "MOTIVO DO ERRO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "CORRIGIDO",
              "displayName": "CORRIGIDO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6000,
        528
      ],
      "id": "ed9b4517-7767-41b4-9602-6956668c6dae",
      "name": "log arquivos1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        2128,
        608
      ],
      "id": "d3cd5c1f-6e1a-4a3d-a37b-1849ef108daa",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "fRrIyxCKgTlReSWb",
          "name": "Kybernan-Arquivador"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2816,
        304
      ],
      "id": "af41894a-e84e-4e45-b04c-0d5a1147e854",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "fieldToSplitOut": "output",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        2336,
        304
      ],
      "id": "efbc1974-6b5e-4797-9ab2-394a1942c724",
      "name": "Split Out"
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Upload file2').item.json.id }}",
          "mode": "id"
        },
        "name": "={{ $('Loop Over Items').item.json.NOME_ARQUIVO }} (ARQUIVADO POR IA)",
        "sameFolder": false,
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        5984,
        272
      ],
      "id": "06462904-6a46-4c7c-a310-24d70fbe78b0",
      "name": "Copy file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Upload file2').item.json.id }}",
          "mode": "id"
        },
        "name": "={{ (new Date()).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }).replace(/\\//g, '.') }} - {{ $('Dados de Entrada').item.json.Nome }} - (SALVADO POR IA)",
        "sameFolder": false,
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "=12JepBiCyidTjZknzUgb8yVOFHZF-Q6Ro",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1936,
        1536
      ],
      "id": "84a0ba27-92bb-4c18-b81d-ab7a3bbaa9ed",
      "name": "Copy file1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2592,
        304
      ],
      "id": "0aea1eea-ccb4-4ac0-a8df-5ff069084138",
      "name": "Merge2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://kybernan_gotenberg:3000/forms/libreoffice/convert",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "landscape",
              "value": "true"
            },
            {
              "parameterType": "formBinaryData",
              "name": "files",
              "inputDataFieldName": "data"
            },
            {
              "name": "addOriginalDocumentAsStream",
              "value": "false"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1072,
        48
      ],
      "id": "1a00927b-11cf-44c2-9d1c-da346e0bc0ec",
      "name": "HTTP Request5"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0ca53349-4a2f-410c-9b0f-d37dbd8379fa",
              "leftValue": "={{ $('HTTP Request3').item.json.mimetype }}",
              "rightValue": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        16,
        464
      ],
      "id": "2ae1adee-50d7-4fbf-9c61-e67f6fa7cc8a",
      "name": "excel?1"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "GPT-4O"
        },
        "text": "Transcreva o que tem nesta imagem, tudo o que exatamente está escrito nela de forma organizada.",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -128,
        1648
      ],
      "id": "ece7a3fb-81d7-497f-b483-f69cac4c79a1",
      "name": "Analyze image",
      "credentials": {
        "openAiApi": {
          "id": "fRrIyxCKgTlReSWb",
          "name": "Kybernan-Arquivador"
        }
      }
    },
    {
      "parameters": {
        "content": "## Se fizer OCR e tiver sem texto",
        "height": 208,
        "width": 528
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -720,
        1600
      ],
      "id": "91beb6ad-6576-4e6c-914f-1023277a46f0",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://kybernan.uazapi.com/message/download",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Accept",
              "value": "application/json"
            },
            {
              "name": "token",
              "value": "4d8e979d-0339-417a-89c6-9e56bc0cead7"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "={{ $('Dados de Entrada').item.json.body.message.messageid }}"
            },
            {
              "name": "return_base64",
              "value": "true"
            },
            {
              "name": "generate_mp3",
              "value": "false"
            },
            {
              "name": "transcribe",
              "value": "false"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -480,
        1664
      ],
      "id": "da57fbe7-a982-400e-8874-66b836589420",
      "name": "HTTP Request6"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64Data",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -304,
        1664
      ],
      "id": "66f8b565-7646-4207-a74e-1b6bce6054bc",
      "name": "Convert to File4"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ",
          "mode": "list",
          "cachedResultName": "LOG ARQUIVOS",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1-MrdPnHE7cmjj_D7spbWq2u0CkatoBgCqvja3aHv4BQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "DATA": "={{ $today.format('dd-MM-yyyy') }}",
            "HORA": "={{ $now.format('hh:mm') }}",
            "CLIENTE": "={{ $('Get row(s)').item.json.NomeGrupo }}",
            "TIPO DE ARQUIVO": "NOTA FISCAL",
            "CAMINHO QUE FOI SALVO": "=PASTA DE NOTAS FISCAIS",
            "LINK ARQUIVO": "=https://drive.google.com/file/d/{{ $json.id }}/view"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "DATA",
              "displayName": "DATA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HORA",
              "displayName": "HORA",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CLIENTE",
              "displayName": "CLIENTE",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TIPO DE ARQUIVO",
              "displayName": "TIPO DE ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LINK ARQUIVO",
              "displayName": "LINK ARQUIVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "CAMINHO QUE FOI SALVO",
              "displayName": "CAMINHO QUE FOI SALVO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "MOTIVO DO ERRO",
              "displayName": "MOTIVO DO ERRO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "CORRIGIDO",
              "displayName": "CORRIGIDO",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1168,
        976
      ],
      "id": "663cb474-45c6-4261-9f2c-a58136864172",
      "name": "NOTA FISCAL",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "75f8e189-a085-4dad-9650-bc8f10936fc0",
              "leftValue": "={{ Number($json.text.length) }}",
              "rightValue": 20,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -192,
        144
      ],
      "id": "04f93ae5-335a-4881-b2b2-74007cddfc3d",
      "name": "Menos que 20 caracteres"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "75f8e189-a085-4dad-9650-bc8f10936fc0",
              "leftValue": "={{ Number($json.text.length) }}",
              "rightValue": 20,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -272,
        1360
      ],
      "id": "2b625636-5b90-42e9-95de-072ff02a2623",
      "name": "Menos que 20 caracteres1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -3648,
        592
      ],
      "id": "acddbb94-728b-4409-a75f-1097a677dfad",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "TvERETBAGi000bZb",
          "mode": "list",
          "cachedResultName": "DadosClienteKybernan",
          "cachedResultUrl": "/projects/72MghKyBe7pL4bex/datatables/TvERETBAGi000bZb"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "IdGroup",
              "keyValue": "={{ $('Dados de Entrada').item.json.body.message.chatid }}"
            },
            {
              "keyName": "phone1",
              "keyValue": "={{ $json.telefone_10_digitos || $json.telefone_11_digitos }}"
            },
            {
              "keyName": "phone2",
              "keyValue": "={{ $json.telefone_10_digitos || $json.telefone_11_digitos }}"
            },
            {
              "keyName": "phone3",
              "keyValue": "={{ $json.telefone_10_digitos || $json.telefone_11_digitos }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -3440,
        624
      ],
      "id": "6465a5b5-be23-4e89-8776-4a474aa9a1f6",
      "name": "Get row(s)1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// O código deve retornar um array de itens.\n// Como precisamos de 2 saídas, retornaremos um array com 2 objetos de item.\n\n// 1. Obter o número de telefone de entrada\n// A entrada está no formato do primeiro item (index 0)\nconst numeroCompleto = $input.first().json.body.message.sender_pn;\n\n// 2. Definir o DDD (os primeiros 2 dígitos)\nconst ddd = numeroCompleto.substring(0, 2);\n\n// 3. Definir o número original sem o DDD\nconst numeroSemDdd = numeroCompleto.substring(2);\n\n// 4. Inicializar as variáveis para as saídas\nlet numero10Digitos;\nlet numero11Digitos;\n\n// 5. Normalizar o número\nif (numeroSemDdd.length === 8) {\n    // Caso de entrada com 10 dígitos (Ex: 1188888888)\n    // Saída de 10 dígitos: Mantém como está\n    numero10Digitos = ddd + numeroSemDdd;\n    \n    // Saída de 11 dígitos: Adiciona o '9' após o DDD\n    numero11Digitos = ddd + '9' + numeroSemDdd;\n    \n} else if (numeroSemDdd.length === 9) {\n    // Caso de entrada com 11 dígitos (Ex: 11988888888)\n    // Saída de 11 dígitos: Mantém como está\n    numero11Digitos = ddd + numeroSemDdd;\n    \n    // Saída de 10 dígitos: Remove o primeiro dígito do número (que deve ser o '9')\n    // Usamos `slice(1)` para remover o primeiro caractere da string.\n    const numeroSemNove = numeroSemDdd.slice(1);\n    numero10Digitos = ddd + numeroSemNove;\n    \n} else {\n    // Caso de erro ou formato inesperado\n    console.error(\"Número de telefone com formato inesperado:\", numeroCompleto);\n    // Para evitar que o workflow pare, vamos apenas usar o número original em ambas as saídas\n    numero10Digitos = numeroCompleto;\n    numero11Digitos = numeroCompleto;\n}\n\n// 6. Criar os dois itens de output\nconst outputItem1 = {\n    json: {\n        telefone_10_digitos: numero10Digitos\n    }\n};\n\nconst outputItem2 = {\n    json: {\n        telefone_11_digitos: numero11Digitos\n    }\n};\n\n// 7. Retornar o array de itens\nreturn [outputItem1, outputItem2];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3648,
        368
      ],
      "id": "939bacb5-4fc1-408b-8b14-e76b13dea785",
      "name": "normalizaNumero"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7fa82878-e3a3-4b6f-9533-8352ea7d4ea0",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3264,
        624
      ],
      "id": "038c3e36-bc0f-4db3-9170-cec274ccad28",
      "name": "seNumeroExisteSegue"
    },
    {
      "parameters": {
        "content": "## Normaliza numero 10 ou 11 digitos, tenta encontrar com ambos no banco de dados",
        "height": 560,
        "width": 592
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3920,
        272
      ],
      "id": "5e686850-6293-41e6-8d9b-12f758a69e63",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1",
          "mode": "list",
          "cachedResultName": "gpt-5.1"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        480,
        1488
      ],
      "id": "3beb4822-f5df-4b4d-841d-6041c9035b66",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "fRrIyxCKgTlReSWb",
          "name": "Kybernan-Arquivador"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3120,
        16
      ],
      "id": "d0391e02-d3b5-4f3e-a6cf-2a8c95a921b1",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "hF9yxdAPWHZWy2CV",
          "mode": "list",
          "cachedResultName": "CODIGO DE BARRAS",
          "cachedResultUrl": "/projects/72MghKyBe7pL4bex/datatables/hF9yxdAPWHZWy2CV"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "idPasta": "={{ $('idPastaDia').item.json.id }}",
            "codBarras": "={{ $('Loop Over Items').item.json.CODIGO_BARRAS }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "codBarras",
              "displayName": "codBarras",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "idPasta",
              "displayName": "idPasta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        6224,
        544
      ],
      "id": "26532152-493d-46c4-9345-7580e4d24544",
      "name": "Insert row"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bbdfcb0e-b11a-4cb9-ae83-00547a243bf0",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5744,
        288
      ],
      "id": "5581deac-20a3-4fca-b7d0-5d3e5318240a",
      "name": "idPastaDia"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a5fc9645-25d9-4077-988f-beeb8aff47c3",
              "leftValue": "={{ $json.body.message.sender_pn }}",
              "rightValue": "19989413439",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4064,
        128
      ],
      "id": "f1cd29ad-a0f3-47e8-833b-d28f3e96aee8",
      "name": "Ana?"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Dados de Entrada",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "isGroup": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          },
          {
            "node": "ExisteGrupoTabela False",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "normalizaNumero",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tipoMsg": {
      "main": [
        [],
        [],
        [],
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ExisteGrupoTabela False": {
      "main": [
        [
          {
            "node": "Insere Novo Row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insere Novo Row": {
      "main": [
        [
          {
            "node": "DADOS USUÁRIO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "DADOS USUÁRIO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontraControle": {
      "main": [
        [
          {
            "node": "encontraAno",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontraAno": {
      "main": [
        [
          {
            "node": "PastaDiaExiste?2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontraMês": {
      "main": [
        [
          {
            "node": "PastaDiaExiste?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encontraDia": {
      "main": [
        [
          {
            "node": "PastaDiaExiste?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PastaDiaExiste?": {
      "main": [
        [
          {
            "node": "idPastaDia",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cria Pasta Dia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "Menos que 20 caracteres1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Convert to File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Convert to File2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File1": {
      "main": [
        [
          {
            "node": "PDFKit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File2": {
      "main": [
        [
          {
            "node": "excel?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Gerar JWT": {
      "main": [
        [
          {
            "node": "CriaTarefaOcr",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UploadPdf": {
      "main": [
        [
          {
            "node": "ProcessPdfToOcr",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ProcessPdfToOcr": {
      "main": [
        [
          {
            "node": "DownloadPdfOcr",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CriaTarefaOcr": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "UploadPdf",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DownloadPdfOcr": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text Classifier": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "NOTA FISCAL",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HOLERITES",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "RECIBOS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "COMPROVANTE PAGAMENTO",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CHEQUES",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "TRANSFERENCIA PIX",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "PEDIDO COMPRA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "OUTROS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DADOS USUÁRIO": {
      "main": [
        [
          {
            "node": "temPasta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Text Classifier",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File1": {
      "main": [
        [
          {
            "node": "Menos que 20 caracteres",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "temPasta": {
      "main": [
        [
          {
            "node": "tipoMsg",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PastaDiaExiste?1": {
      "main": [
        [
          {
            "node": "idPastaMes",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cria Pasta Mes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PastaDiaExiste?2": {
      "main": [
        [
          {
            "node": "idPastaAno",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cria Pasta Ano",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dados de Entrada": {
      "main": [
        [
          {
            "node": "Ana?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cria Pasta Ano": {
      "main": [
        [
          {
            "node": "idPastaAno",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cria Pasta Mes": {
      "main": [
        [
          {
            "node": "idPastaMes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cria Pasta Dia": {
      "main": [
        [
          {
            "node": "idPastaDia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload file2": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "excel?": {
      "main": [
        [
          {
            "node": "HTTP Request5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PDFKit": {
      "main": [
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "idPastaAno": {
      "main": [
        [
          {
            "node": "encontraMês",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "idPastaMes": {
      "main": [
        [
          {
            "node": "encontraDia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "excel?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Upload file2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "Convert to File3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File3": {
      "main": [
        [
          {
            "node": "Gerar JWT",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "encontraControle",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "log arquivos1": {
      "main": [
        [
          {
            "node": "Insert row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Copy file": {
      "main": [
        [
          {
            "node": "log arquivos1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Copy file1": {
      "main": [
        []
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request5": {
      "main": [
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel?1": {
      "main": [
        [],
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze image": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request6": {
      "main": [
        [
          {
            "node": "Convert to File4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File4": {
      "main": [
        [
          {
            "node": "Analyze image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NOTA FISCAL": {
      "main": [
        [
          {
            "node": "Copy file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OUTROS": {
      "main": [
        []
      ]
    },
    "HOLERITES": {
      "main": [
        [
          {
            "node": "Copy file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RECIBOS": {
      "main": [
        [
          {
            "node": "Copy file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CHEQUES": {
      "main": [
        [
          {
            "node": "Copy file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PEDIDO COMPRA": {
      "main": [
        [
          {
            "node": "Copy file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menos que 20 caracteres": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Menos que 20 caracteres1": {
      "main": [
        [
          {
            "node": "HTTP Request6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Get row(s)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)1": {
      "main": [
        [
          {
            "node": "seNumeroExisteSegue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "normalizaNumero": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "seNumeroExisteSegue": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Text Classifier",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Insert row": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "idPastaDia": {
      "main": [
        [
          {
            "node": "Copy file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ana?": {
      "main": [
        [
          {
            "node": "isGroup",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "YIG6qfQJNEIBlPcM"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "kybernan-n8n-webhook.qdidmr.easypanel.host",
            "user-agent": "uazapiGO-Webhook/1.0",
            "content-length": "3032",
            "accept-encoding": "gzip",
            "content-type": "application/json",
            "x-forwarded-for": "187.45.178.254",
            "x-forwarded-host": "kybernan-n8n-webhook.qdidmr.easypanel.host",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "c907cab5af03",
            "x-real-ip": "187.45.178.254"
          },
          "params": {},
          "query": {},
          "body": {
            "BaseUrl": "https://kybernan.uazapi.com",
            "EventType": "messages",
            "chat": {
              "chatbot_agentResetMemoryAt": 0,
              "chatbot_disableUntil": 0,
              "chatbot_lastTriggerAt": 0,
              "chatbot_lastTrigger_id": "",
              "id": "r5179105d33b663",
              "image": "",
              "imagePreview": "",
              "lead_assignedAttendant_id": "",
              "lead_email": "",
              "lead_field01": "",
              "lead_field02": "",
              "lead_field03": "",
              "lead_field04": "",
              "lead_field05": "",
              "lead_field06": "",
              "lead_field07": "",
              "lead_field08": "",
              "lead_field09": "",
              "lead_field10": "",
              "lead_field11": "",
              "lead_field12": "",
              "lead_field13": "",
              "lead_field14": "",
              "lead_field15": "",
              "lead_field16": "",
              "lead_field17": "",
              "lead_field18": "",
              "lead_field19": "",
              "lead_field20": "",
              "lead_fullName": "",
              "lead_isTicketOpen": false,
              "lead_kanbanOrder": 0,
              "lead_name": "",
              "lead_notes": "",
              "lead_personalid": "",
              "lead_status": "",
              "lead_tags": [],
              "name": "LELEY FOODS - BPO/KY",
              "owner": "5519995586796",
              "phone": "",
              "wa_archived": false,
              "wa_chatid": "120363401866070546@g.us",
              "wa_chatlid": "",
              "wa_contactName": "",
              "wa_ephemeralExpiration": 0,
              "wa_fastid": "5519995586796:120363401866070546",
              "wa_isBlocked": false,
              "wa_isGroup": true,
              "wa_isGroup_admin": true,
              "wa_isGroup_announce": false,
              "wa_isGroup_community": false,
              "wa_isGroup_member": true,
              "wa_isPinned": false,
              "wa_label": [],
              "wa_lastMessageSender": "224193132101769@lid",
              "wa_lastMessageTextVote": "",
              "wa_lastMessageType": "DocumentMessage",
              "wa_lastMsgTimestamp": 1764769620000,
              "wa_muteEndTime": 0,
              "wa_name": "LELEY FOODS - BPO/KY",
              "wa_unreadCount": 151
            },
            "instanceName": "CelKybernan",
            "message": {
              "buttonOrListid": "",
              "chatid": "120363401866070546@g.us",
              "content": {
                "URL": "https://mmg.whatsapp.net/v/t62.7119-24/594014130_1145464431077324_3402262979922838172_n.enc?ccb=11-4&oh=01_Q5Aa3AHN_J_95ZdHGvBA858tp3qI5jfZ18x2nJO_1x1za0HMIA&oe=6957AC31&_nc_sid=5e03e0&mms3=true",
                "mimetype": "application/pdf",
                "title": "boleto 149141.pdf",
                "fileSHA256": "VWKea3jgg6P8mPCeEiLXJRvdsSKjyaQvTWJWBa85ysQ=",
                "fileLength": 211043,
                "pageCount": 1,
                "mediaKey": "hYJVpADh3bIBMzwbWiuy5b+uuzxbSAcjCNtm7lVeaD8=",
                "fileName": "boleto 149141.pdf",
                "fileEncSHA256": "XeGibgJEhcOcOI6bzcUvO2Ew+B1nm5cmbgQksSx9p0o=",
                "directPath": "/v/t62.7119-24/594014130_1145464431077324_3402262979922838172_n.enc?ccb=11-4&oh=01_Q5Aa3AHN_J_95ZdHGvBA858tp3qI5jfZ18x2nJO_1x1za0HMIA&oe=6957AC31&_nc_sid=5e03e0&_nc_hot=1764769620",
                "mediaKeyTimestamp": 1764769617,
                "contactVcard": false,
                "contextInfo": {
                  "forwardingScore": 1,
                  "isForwarded": true,
                  "pairedMediaType": 0
                }
              },
              "convertOptions": "",
              "edited": "",
              "fromMe": false,
              "groupName": "LELEY FOODS - BPO/KY",
              "id": "5519995586796:3A33B5D95919723C4B8A",
              "isGroup": true,
              "mediaType": "document",
              "messageTimestamp": 1764769620000,
              "messageType": "DocumentMessage",
              "messageid": "3A33B5D95919723C4B8A",
              "owner": "5519995586796",
              "quoted": "",
              "reaction": "",
              "sender": "224193132101769@lid",
              "senderName": "Kederley",
              "sender_lid": "224193132101769@lid",
              "sender_pn": "5519981804818@s.whatsapp.net",
              "source": "ios",
              "status": "",
              "text": "",
              "track_id": "",
              "track_source": "",
              "type": "media",
              "vote": "",
              "wasSentByApi": false
            },
            "owner": "5519995586796",
            "token": "4d8e979d-0339-417a-89c6-9e56bc0cead7"
          },
          "webhookUrl": "https://kybernan-n8n-webhook.qdidmr.easypanel.host/webhook/6ff257a0-6494-492b-af31-5214a9bd20a1",
          "executionMode": "production"
        }
      }
    ]
  },
  "versionId": "0da9f461-1cbc-4ca4-a681-2838781e8345",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-11-26T10:17:15.840Z",
      "createdAt": "2025-11-26T10:17:15.840Z",
      "role": "workflow:owner",
      "workflowId": "xbiM1JT5KjJBCrxu",
      "projectId": "72MghKyBe7pL4bex"
    }
  ],
  "tags": []
}