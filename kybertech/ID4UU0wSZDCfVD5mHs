{
  "updatedAt": "2026-01-12T15:45:23.465Z",
  "createdAt": "2025-12-17T13:27:06.794Z",
  "id": "4UU0wSZDCfVD5mHs",
  "name": "CONCILIAÇÃO PRINCIPAL",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "content": "## TRIGGER TELEGRAM\nPERGUNTANDO DE QUAL EMPRESA É",
        "height": 448,
        "width": 448
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1840,
        -784
      ],
      "id": "6ae793e5-2109-4347-9b82-40406df0c0ac",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## LÊ E ENTENDE OS DADOS E INTERPRETA GERANDO UM ARRAY\n",
        "height": 784,
        "width": 560
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1024,
        -1056
      ],
      "id": "221bd780-b3ec-4a54-b013-98682ff3fba4",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## NORMALIZA OS DADOS PARA FICAREM PADRONIZADOS INDEPENDENTE DA FORMA QUE CHEGAR",
        "height": 464,
        "width": 448
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -352,
        -928
      ],
      "id": "8e8559de-aa26-4265-ada9-ab5185a6e90e",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## IDENTIFICA A EMPRESA E SEU RESPECTIVO SISTEMA E API PELO BANCO DE DADOS",
        "height": 432,
        "width": 336
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -128,
        -144
      ],
      "id": "404c6300-2687-4219-b563-acfc86cdc17b",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## LANÇA NA API DO SISTEMA CORRETO COM AS CREDENCIAIS",
        "height": 432
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1056,
        -144
      ],
      "id": "b8641eb4-3e9c-437e-9d0d-4f1907150ca7",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "## verifica no sistema do cliente os que já estão lançados e faz um MERGE para validar o que realmente precisa ser lançado\n",
        "height": 432,
        "width": 416
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        288,
        -144
      ],
      "id": "b39e1eb5-9861-4fc3-b556-14b5461269f0",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {
          "download": true
        }
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1792,
        -608
      ],
      "id": "ec06b256-d852-4dff-9829-d80dcca7459c",
      "name": "Telegram Trigger",
      "webhookId": "079e735b-3442-46a2-8149-bfe1300a9e49",
      "credentials": {
        "telegramApi": {
          "id": "jciBUUGqi15C8nzu",
          "name": "CONCILIADOR FINANCEIRO KYBERNAN"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "K29Z4unzBhzw2kCh",
          "mode": "list",
          "cachedResultName": "CadastroClientesSistemaAPI",
          "cachedResultUrl": "/projects/72MghKyBe7pL4bex/datatables/K29Z4unzBhzw2kCh"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "NOME",
              "keyValue": "={{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }}"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -16,
        80
      ],
      "id": "b09631a6-291b-4c95-a877-3c18086e6216",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "binaryPropertyName": "={{ $('Telegram Trigger').item.binary.data }}",
        "options": {
          "headerRow": true,
          "range": "9"
        }
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -896,
        -960
      ],
      "id": "279c6ea1-0693-4b85-959a-511b8d13f90b",
      "name": "Extract from File"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "97a88027-fb5b-4f04-b307-bd794daf3b83",
              "name": "DATA DA VENDA",
              "value": "={{ $json['Data da venda'] }}",
              "type": "string"
            },
            {
              "id": "2acc3632-75e2-457a-8053-d0d4113aa1f4",
              "name": "PRODUTO",
              "value": "={{ $json['Forma de pagamento'] }}",
              "type": "string"
            },
            {
              "id": "e35c48e8-5eec-4889-8f1d-f903f44c57c2",
              "name": "VALOR BRUTO",
              "value": "={{ $json['Valor bruto'] }}",
              "type": "number"
            },
            {
              "id": "e35ebb0b-8f5e-4537-9f7f-8318fa25a71f",
              "name": "VALOR LIQUIDO",
              "value": "={{ $json['Valor líquido'] }}",
              "type": "number"
            },
            {
              "id": "a0c1019d-6978-4fc0-8cb0-6c9b0de1703d",
              "name": "DESCONTO DE MDR",
              "value": "={{ $json['Taxa/tarifa'] }}",
              "type": "number"
            },
            {
              "id": "25feee2d-d497-45b9-b6ef-19ec479bf499",
              "name": "ULTIMO STATUS",
              "value": "={{ $json['Status da venda'] }}",
              "type": "string"
            },
            {
              "id": "0401d747-e989-407a-9d03-1b01bc15f605",
              "name": "BANDEIRA",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -704,
        -960
      ],
      "id": "0bf96110-9781-4bf9-9f18-1fff77d95cf6",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "sendAndWait",
        "chatId": "={{ $json.message.chat.id }}",
        "message": "Qual maquininha?",
        "responseType": "customForm",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Qual maquininha?",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "Stone"
                  },
                  {
                    "option": "Cielo"
                  },
                  {
                    "option": "Azulzinha"
                  },
                  {
                    "option": "GetNet"
                  },
                  {
                    "option": "PagSeguro"
                  }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "Qual empresa?",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "MERAKI"
                  },
                  {
                    "option": "OUTRAS (TESTE)"
                  }
                ]
              },
              "requiredField": true
            }
          ]
        },
        "options": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -1600,
        -608
      ],
      "id": "f1ca364d-734f-4151-903f-73651f535e84",
      "name": "Send message and wait for response1",
      "webhookId": "d896def6-dd5c-438a-8454-be8560926a32",
      "credentials": {
        "telegramApi": {
          "id": "jciBUUGqi15C8nzu",
          "name": "CONCILIADOR FINANCEIRO KYBERNAN"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                    "rightValue": "Cielo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ed0b9f5f-7698-4f6d-9450-26b398878a22"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cielo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "046d0f00-6b1c-4c87-9fc2-17288e7fef0f",
                    "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                    "rightValue": "Azulzinha",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Azulzinha"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "596d426f-b7b8-43d8-995c-3299bd538406",
                    "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                    "rightValue": "GetNet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "GetNet"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c47fd869-0e16-43fe-8e37-a2b6512feef3",
                    "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                    "rightValue": "Stone",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Stone"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "976439c0-c3fd-4ff0-b88d-54585c556076",
                    "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                    "rightValue": "PagSeguro",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "PagSeguro"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -1280,
        -640
      ],
      "id": "fa7a3bde-4f08-4658-acec-341bbeb54de9",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "binaryPropertyName": "={{ $('Telegram Trigger').item.binary.data }}",
        "options": {
          "headerRow": true,
          "range": "4"
        }
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -896,
        -784
      ],
      "id": "ffd20005-4fe9-4d36-b9fa-c985a6fd976e",
      "name": "Extract from File1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "97a88027-fb5b-4f04-b307-bd794daf3b83",
              "name": "DATA DA VENDA",
              "value": "={{ $json['Data da venda'] }}",
              "type": "string"
            },
            {
              "id": "2acc3632-75e2-457a-8053-d0d4113aa1f4",
              "name": "PRODUTO",
              "value": "={{ $json.Produto }}",
              "type": "string"
            },
            {
              "id": "e35c48e8-5eec-4889-8f1d-f903f44c57c2",
              "name": "VALOR BRUTO",
              "value": "={{ $json['Valor bruto da transação'] }}",
              "type": "number"
            },
            {
              "id": "e35ebb0b-8f5e-4537-9f7f-8318fa25a71f",
              "name": "VALOR LIQUIDO",
              "value": "={{ $json['Valor líquido da parcela/transação'] }}",
              "type": "number"
            },
            {
              "id": "a0c1019d-6978-4fc0-8cb0-6c9b0de1703d",
              "name": "DESCONTO DE MDR",
              "value": "={{ $json['Valor da taxa (MDR)'] }}",
              "type": "number"
            },
            {
              "id": "25feee2d-d497-45b9-b6ef-19ec479bf499",
              "name": "ULTIMO STATUS",
              "value": "={{ $json['Status do pagamento da venda'] }}",
              "type": "string"
            },
            {
              "id": "1daa56c0-1798-4869-96d6-c51575ae735c",
              "name": "BANDEIRA",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -704,
        -784
      ],
      "id": "709559e1-eb18-4ac5-9eac-db37d14ee326",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "binaryPropertyName": "={{ $('Telegram Trigger').item.binary.data }}",
        "options": {
          "headerRow": true,
          "range": "0"
        }
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -912,
        -432
      ],
      "id": "4d1b41b1-d846-4393-aad2-1ea00e9a34c1",
      "name": "Extract from File2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "97a88027-fb5b-4f04-b307-bd794daf3b83",
              "name": "DATA DA VENDA",
              "value": "={{ $json['DATA DA VENDA'].split(' ')[0] }}",
              "type": "string"
            },
            {
              "id": "2acc3632-75e2-457a-8053-d0d4113aa1f4",
              "name": "PRODUTO",
              "value": "={{ $json.PRODUTO }}",
              "type": "string"
            },
            {
              "id": "e35c48e8-5eec-4889-8f1d-f903f44c57c2",
              "name": "VALOR BRUTO",
              "value": "={{ parseFloat($json['VALOR BRUTO'].replace(',', '.')) }}",
              "type": "number"
            },
            {
              "id": "e35ebb0b-8f5e-4537-9f7f-8318fa25a71f",
              "name": "VALOR LIQUIDO",
              "value": "={{ parseFloat($json['VALOR LIQUIDO'].replace(',', '.')) }}",
              "type": "number"
            },
            {
              "id": "a0c1019d-6978-4fc0-8cb0-6c9b0de1703d",
              "name": "DESCONTO DE MDR",
              "value": "={{ parseFloat($json['DESCONTO DE MDR'].replace(',', '.')) }}",
              "type": "number"
            },
            {
              "id": "25feee2d-d497-45b9-b6ef-19ec479bf499",
              "name": "ULTIMO STATUS",
              "value": "={{ $json['ULTIMO STATUS'] }}",
              "type": "string"
            },
            {
              "id": "23c1af1c-f0bd-425c-8c05-4d820573157d",
              "name": "BANDEIRA",
              "value": "={{ $json.BANDEIRA }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -704,
        -432
      ],
      "id": "005e9e4d-98a1-47e9-972d-ad53c9325b41",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "970c8fe2-1695-4dd0-8073-61fb7cd0f8c1",
              "name": "DATA DA VENDA",
              "value": "={{ $json['DATA DA VENDA'] }}",
              "type": "string"
            },
            {
              "id": "52499be6-ad8e-4a03-92e1-056d7bbe32b2",
              "name": "PRODUTO",
              "value": "={{ $json.PRODUTO }}",
              "type": "string"
            },
            {
              "id": "85bb24c5-b4d1-4799-90d3-8c3da56e287b",
              "name": "VALOR BRUTO",
              "value": "={{ $json['VALOR BRUTO'] }}",
              "type": "number"
            },
            {
              "id": "5ff4548e-af5f-4d0d-a0e0-16000fbd3d28",
              "name": "VALOR LIQUIDO",
              "value": "={{ $json['VALOR LIQUIDO'] }}",
              "type": "number"
            },
            {
              "id": "13a59c9c-049d-4651-aa65-a333e0e21534",
              "name": "DESCONTO DE MDR",
              "value": "={{ $json['DESCONTO DE MDR'] }}",
              "type": "number"
            },
            {
              "id": "3ef36e11-ee76-4fea-8ae5-2c6efd38d8ec",
              "name": "ULTIMO STATUS",
              "value": "={{ $json['ULTIMO STATUS'] }}",
              "type": "string"
            },
            {
              "id": "ecded5dc-749b-4191-8270-78e88c4bef2f",
              "name": "MAQUININHA",
              "value": "={{ $('Send message and wait for response1').item.json.data['Qual maquininha?'] }}",
              "type": "string"
            },
            {
              "id": "07af5b79-9b3e-4c20-b4be-027bad61f814",
              "name": "data['Qual empresa?']",
              "value": "={{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }}",
              "type": "string"
            },
            {
              "id": "7fab4c36-6f4c-4f42-8c65-2139d58938f8",
              "name": "BANDEIRA",
              "value": "={{ $json.BANDEIRA }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -304,
        -720
      ],
      "id": "5a6ed770-effe-4aa4-a48e-e178d635e8bd",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "jsCode": "// Função auxiliar para formatar moeda (ex: 1234.56 -> \"1234,56\")\nfunction formatCurrency(value) {\n    return value.toFixed(2).replace('.', ',');\n}\n\n// Armazena os dados agrupados (Sucesso)\nconst groupedData = {};\n// Armazena as linhas com erro (Falha)\nconst errorItems = [];\n\n// Lista de Bandeiras que consideramos como Vouchers/Tickets\nconst voucherFlags = [\"ticket\", \"alelo\", \"vr\", \"sodexo\", \"verocard\", \"verocheque\", \"vegascard\", \"pluxee\", \"confarma\"];\n\n// Itera sobre todos os itens recebidos\nfor (const item of items) {\n    const json = item.json;\n\n    // --- 1. EXTRAÇÃO DE DADOS ---\n    const rawDate = json[\"DATA DA VENDA\"];\n    \n    // Tratamento de Valores: Garante positivo (Math.abs) e número\n    const rawValBruto = Math.abs(parseFloat(json[\"VALOR BRUTO\"] || 0)); \n    const rawValLiquido = Math.abs(parseFloat(json[\"VALOR LIQUIDO\"] || 0)); \n    const rawValMdr = Math.abs(parseFloat(json[\"DESCONTO DE MDR\"] || 0)); \n    \n    const produtoRaw = (json[\"PRODUTO\"] || \"\").trim();\n    const produto = produtoRaw.toLowerCase();\n    \n    const maquininhaRaw = (json[\"MAQUININHA\"] || \"\").trim();\n    const maquininha = maquininhaRaw.toLowerCase();\n    \n    const bandeiraRaw = (json[\"BANDEIRA\"] || \"\").trim();\n    const bandeira = bandeiraRaw.toLowerCase();\n\n    // --- 2. LÓGICA DA CATEGORIA A RECEBER ---\n    let categoriaReceber = \"A DEFINIR\";\n\n    const isPix = produto.includes(\"pix\");\n    const isDebito = produto.includes(\"debito\") || produto.includes(\"débito\");\n    const isCredito = produto.includes(\"credito\") || produto.includes(\"crédito\");\n    const isVoucher = produto.includes(\"voucher\") || voucherFlags.some(flag => bandeira.includes(flag));\n\n    if (isPix) {\n        if (maquininha.includes(\"stone\")) categoriaReceber = \"Recebimento por Maquininha STONE  Pix\";\n        else if (maquininha.includes(\"pagseguro\")) categoriaReceber = \"Recebimento por Maquininha PAGSEGURO Pix\";\n        else categoriaReceber = \"Recebimento por PIX\";\n    } \n    else if (isVoucher) {\n        // Conforme solicitado, Vouchers vão para esta categoria\n        categoriaReceber = \"Recebimento por Maquininha TICKET\";\n    }\n    else if (isDebito) {\n        if (maquininha.includes(\"getnet\")) categoriaReceber = \"Recebimento por Maquininha GETNET Débito\";\n        else if (maquininha.includes(\"stone\")) categoriaReceber = \"Recebimento por Maquininha STONE  Débito\";\n        else if (maquininha.includes(\"cielo\")) categoriaReceber = \"Recebimento por Maquininha CIELO Débito\";\n        else if (maquininha.includes(\"azulzinha\")) categoriaReceber = \"Recebimento por Maquininha AZULZINHA Débito\";\n        else if (maquininha.includes(\"pagseguro\")) categoriaReceber = \"Recebimento por Maquininha PAGSEGURO Débito\";\n    }\n    else if (isCredito) {\n        if (maquininha.includes(\"getnet\")) categoriaReceber = \"Recebimento por Maquininha GETNET Crédito\";\n        else if (maquininha.includes(\"stone\")) categoriaReceber = \"Recebimento por Maquininha STONE Crédito\";\n        else if (maquininha.includes(\"cielo\")) categoriaReceber = \"Recebimento por Maquininha CIELO Crédito\";\n        else if (maquininha.includes(\"azulzinha\")) categoriaReceber = \"Recebimento por Maquininha AZULZINHA Crédito\";\n        else if (maquininha.includes(\"pagseguro\")) categoriaReceber = \"Recebimento por Maquininha PAGSEGURO Crédito\";\n    }\n\n    // --- 3. LÓGICA DA CONTA CORRENTE ---\n    let contaCorrente = \"A DEFINIR\";\n\n    if (isVoucher) {\n        if (bandeira.includes(\"alelo\")) contaCorrente = \"Alelo\";\n        else if (bandeira.includes(\"vr\")) contaCorrente = \"VR\";\n        else if (bandeira.includes(\"ticket\")) contaCorrente = \"Ticket\";\n        else if (bandeira.includes(\"pluxee\")) contaCorrente = \"Pluxee\";\n        else if (bandeira.includes(\"vegascard\")) contaCorrente = \"VEGASCARD\";\n        else if (bandeira.includes(\"verocheque\") || bandeira.includes(\"verocard\")) contaCorrente = \"VEROCHEQUE\"; \n        else if (bandeira.includes(\"confarma\")) contaCorrente = \"CONFARMA\";\n        // REGRA NOVA ADICIONADA AQUI:\n        else if (bandeira.includes(\"elo\")) contaCorrente = \"GetNet\";\n    } else {\n        if (maquininha.includes(\"stone\")) contaCorrente = \"Stone\";\n        else if (maquininha.includes(\"getnet\")) contaCorrente = \"GetNet\";\n        else if (maquininha.includes(\"cielo\")) contaCorrente = \"CIELO\";\n        else if (maquininha.includes(\"pagseguro\")) contaCorrente = \"PagSeguro\";\n        else if (maquininha.includes(\"azulzinha\")) contaCorrente = \"Azulzinha (Caixa Econômica Federal)\";\n        else if (maquininha.includes(\"santander\")) contaCorrente = \"Santander\";\n        else if (maquininha.includes(\"topazio\") || maquininha.includes(\"topázio\")) contaCorrente = \"Banco Topázio\";\n    }\n\n    // --- 4. SEPARAÇÃO ERRO VS SUCESSO ---\n    if (categoriaReceber === \"A DEFINIR\" || contaCorrente === \"A DEFINIR\") {\n        \n        let motivoErro = [];\n        if (categoriaReceber === \"A DEFINIR\") motivoErro.push(\"Categoria não identificada\");\n        if (contaCorrente === \"A DEFINIR\") motivoErro.push(\"Conta não identificada\");\n\n        // Adiciona à lista de erros (sem somar)\n        errorItems.push({\n            json: {\n                \"TIPO_RESULTADO\": \"ERRO\", \n                \"STATUS_PROCESSAMENTO\": \"ERRO\",\n                \"MOTIVO_ERRO\": motivoErro.join(\" E \"),\n                \"DEBUG_INFO\": `Produto: '${produtoRaw}' | Maquininha: '${maquininhaRaw}' | Bandeira: '${bandeiraRaw}'`,\n                ...json \n            }\n        });\n\n    } else {\n        // --- 5. AGRUPAMENTO (SUCESSO) ---\n        const uniqueKey = `${rawDate}|${categoriaReceber}|${contaCorrente}`;\n\n        if (!groupedData[uniqueKey]) {\n            groupedData[uniqueKey] = {\n                data: rawDate,\n                catReceber: categoriaReceber,\n                conta: contaCorrente,\n                totalBruto: 0,\n                totalLiquido: 0,\n                totalMdr: 0\n            };\n        }\n        \n        groupedData[uniqueKey].totalBruto += rawValBruto;\n        groupedData[uniqueKey].totalLiquido += rawValLiquido;\n        groupedData[uniqueKey].totalMdr += rawValMdr;\n    }\n}\n\n// --- 6. UNIFICAÇÃO DO OUTPUT ---\n\n// Transforma os agrupados em formato n8n\nconst successOutput = Object.values(groupedData).map(group => {\n    return {\n        json: {\n            \"TIPO_RESULTADO\": \"SUCESSO\",\n            \"Data\": group.data,\n            \"CATEGORIA_A_PAGAR\": \"Juros sobre maquininha de cartão\",\n            \"CATEGORIA_A_RECEBER\": group.catReceber,\n            \"CONTA_CORRENTE\": group.conta,\n            \"Valor Total\": formatCurrency(group.totalBruto),\n            \"Valor Liquido\": formatCurrency(group.totalLiquido),\n            \"Valor Desconto MDR\": formatCurrency(group.totalMdr)\n        }\n    };\n});\n\n// Junta tudo em uma única lista plana (Array de objetos)\nconst finalOutput = [...successOutput, ...errorItems];\n\nreturn finalOutput;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        272,
        -736
      ],
      "id": "15518bfd-5c02-411d-859a-45058e71df60",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "content": "## gerar saídas prontas para serem lançadas no arquivo",
        "height": 464,
        "width": 288
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        192,
        -928
      ],
      "id": "d824e136-fff4-4ddb-b918-6f85edb0d8d6",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "1NR3iLkFLRh-HKWs09GG4tLee-ahrcFl79TSmAcgxLlQ",
          "mode": "list",
          "cachedResultName": "Omie_Contas_Pagar_v1_1_5",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NR3iLkFLRh-HKWs09GG4tLee-ahrcFl79TSmAcgxLlQ/edit?usp=drivesdk"
        },
        "name": "=OMIE contas a PAGAR - {{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }} - {{ $now.format('dd-MM-yyyy') }}",
        "sameFolder": false,
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1_WVesCqzjc0eVw9ktk8HuoGFGsJh493P",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        176,
        -1088
      ],
      "id": "f90762af-772a-4033-b98f-ebb6b8213097",
      "name": "COPIA CONTAS A PAGAR",
      "executeOnce": true,
      "alwaysOutputData": false,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1008,
        -736
      ],
      "id": "8d3130f5-48be-4608-b114-173e1b567de5",
      "name": "Merge"
    },
    {
      "parameters": {
        "operation": "copy",
        "fileId": {
          "__rl": true,
          "value": "1Fbbyzp6O4xIqb4cL_6I4Ijd23H5i72XyBRFuKXqo4VA",
          "mode": "list",
          "cachedResultName": "Omie_Contas_Receber_v1_0_6",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Fbbyzp6O4xIqb4cL_6I4Ijd23H5i72XyBRFuKXqo4VA/edit?usp=drivesdk"
        },
        "name": "=OMIE contas a RECEBER - {{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }} - {{ $now.format('dd-MM-yyyy') }}",
        "sameFolder": false,
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1_WVesCqzjc0eVw9ktk8HuoGFGsJh493P",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        384,
        -1088
      ],
      "id": "df9b3ed8-8801-4448-aad0-b0cb3e076334",
      "name": "COPIA CONTAS A RECEBER",
      "executeOnce": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "a28f997a-b036-4ba3-b124-d310546917cb",
              "leftValue": "={{ $json.TIPO_RESULTADO }}",
              "rightValue": "SUCESSO",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        560,
        -736
      ],
      "id": "34a316dc-b0e1-473c-931e-c3b0a10d2e32",
      "name": "ERRO?"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $('COPIA CONTAS A PAGAR').item.json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Omie_Contas_Pagar",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Categoria *": "={{ $json.CATEGORIA_A_PAGAR }}",
            "Fornecedor * (Razão Social, Nome Fantasia, CNPJ ou CPF)": "MERAKI CAFETERIA LTDA",
            "Conta Corrente *": "={{ $json.CONTA_CORRENTE }}",
            "Valor da Conta *": "={{ $json['Valor Total'] }}",
            "Data de Emissão": "={{ $json.Data }}",
            "Data de Registro *": "={{ $json.Data }}",
            "Data de Vencimento *": "={{ $json.Data }}",
            "Data de Previsão": "={{ $json.Data }}",
            "Data do Pagamento": "={{ $json.Data }}",
            "Valor do Pagamento": "={{ $json['Valor Total'] }}",
            "Data de Conciliação": "={{ $json.Data }}",
            "row_number": "={{ $json.codigo }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Código de Integração",
              "displayName": "Código de Integração",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Fornecedor * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
              "displayName": "Fornecedor * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Categoria *",
              "displayName": "Categoria *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Conta Corrente *",
              "displayName": "Conta Corrente *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Valor da Conta *",
              "displayName": "Valor da Conta *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Vendedor",
              "displayName": "Vendedor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Projeto",
              "displayName": "Projeto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Data de Emissão",
              "displayName": "Data de Emissão",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Registro *",
              "displayName": "Data de Registro *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Vencimento *",
              "displayName": "Data de Vencimento *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Previsão",
              "displayName": "Data de Previsão",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data do Pagamento",
              "displayName": "Data do Pagamento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Valor do Pagamento",
              "displayName": "Valor do Pagamento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Juros",
              "displayName": "Juros",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Multa",
              "displayName": "Multa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Desconto",
              "displayName": "Desconto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Data de Conciliação",
              "displayName": "Data de Conciliação",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Observações",
              "displayName": "Observações",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Tipo de Documento",
              "displayName": "Tipo de Documento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Número do Documento",
              "displayName": "Número do Documento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Parcela",
              "displayName": "Parcela",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Total de Parcelas",
              "displayName": "Total de Parcelas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Número do Pedido",
              "displayName": "Número do Pedido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nota Fiscal",
              "displayName": "Nota Fiscal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Chave da NF-e",
              "displayName": "Chave da NF-e",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Forma de Pagamento",
              "displayName": "Forma de Pagamento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Código de Barras do Boleto",
              "displayName": "Código de Barras do Boleto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "% de Juros ao Mês do Boleto",
              "displayName": "% de Juros ao Mês do Boleto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "% de Multa por Atraso do Boleto",
              "displayName": "% de Multa por Atraso do Boleto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Banco da Transferência",
              "displayName": "Banco da Transferência",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Agência da Transferência",
              "displayName": "Agência da Transferência",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Conta Corrente da Transferência",
              "displayName": "Conta Corrente da Transferência",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "CNPJ ou CPF do Titular",
              "displayName": "CNPJ ou CPF do Titular",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nome do Titular da Conta",
              "displayName": "Nome do Titular da Conta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Finalidade da Transferência",
              "displayName": "Finalidade da Transferência",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Chave Pix",
              "displayName": "Chave Pix",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor PIS",
              "displayName": "Valor PIS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter PIS",
              "displayName": "Reter PIS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor COFINS",
              "displayName": "Valor COFINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter COFINS",
              "displayName": "Reter COFINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor CSLL",
              "displayName": "Valor CSLL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter CSLL",
              "displayName": "Reter CSLL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor IR",
              "displayName": "Valor IR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter IR",
              "displayName": "Reter IR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor ISS",
              "displayName": "Valor ISS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter ISS",
              "displayName": "Reter ISS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor INSS",
              "displayName": "Valor INSS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter INSS",
              "displayName": "Reter INSS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Departamento (100%)",
              "displayName": "Departamento (100%)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Número da NF (serviço tomado)",
              "displayName": "Número da NF (serviço tomado)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Série",
              "displayName": "Série",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Código do Serviço (LC116)",
              "displayName": "Código do Serviço (LC116)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor total da NF",
              "displayName": "Valor total da NF",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "CST do PIS",
              "displayName": "CST do PIS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Base de Cálculo - PIS",
              "displayName": "Base de Cálculo - PIS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Alíquota do PIS (%)",
              "displayName": "Alíquota do PIS (%)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor do PIS",
              "displayName": "Valor do PIS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "CST do COFINS",
              "displayName": "CST do COFINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Base de cálculo - COFINS",
              "displayName": "Base de cálculo - COFINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Alíquota  do COFINS (%)",
              "displayName": "Alíquota  do COFINS (%)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor do COFINS",
              "displayName": "Valor do COFINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "locationDefine": {
            "values": {
              "headerRow": 5,
              "firstDataRow": 6
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2752,
        -464
      ],
      "id": "6ad8cfe5-8cdb-4d79-a13d-ae17f9add742",
      "name": "ATUALIZA CONTAS A PAGAR",
      "executeOnce": false,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "671a3362-c31a-41bc-a551-40c4614eab40",
              "leftValue": "={{ $json.CATEGORIA_A_RECEBER }}",
              "rightValue": "Recebimento por Maquininha TICKET",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1232,
        -736
      ],
      "id": "13e60a9e-b78d-44f4-ad1e-a2b0cf124088",
      "name": "voucher / ticket",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('COPIA CONTAS A PAGAR').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "binaryPropertyName": "data",
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
              "sheetsToFormat": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            }
          },
          "fileName": "={{ $('COPIA CONTAS A PAGAR').item.json.name }}.xlsx"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3024,
        -464
      ],
      "id": "6b3a483b-3eaa-49ac-9df2-8a08f9e8a21a",
      "name": "Download file",
      "executeOnce": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3248,
        -464
      ],
      "id": "2fd9cd62-7140-423f-9aa5-e85c0d8da5e1",
      "name": "Send a document",
      "webhookId": "08b0fb0a-7902-40b7-b930-b5bd95042da8",
      "credentials": {
        "telegramApi": {
          "id": "jciBUUGqi15C8nzu",
          "name": "CONCILIADOR FINANCEIRO KYBERNAN"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2bdb95e5-ac35-4892-b19b-04ccc68e9b9a",
              "name": "Data",
              "value": "={{ $json.Data }}",
              "type": "string"
            },
            {
              "id": "499638e4-8a13-4ed0-a690-76fd06b4198d",
              "name": "CATEGORIA_A_PAGAR",
              "value": "={{ $json.CATEGORIA_A_PAGAR }}",
              "type": "string"
            },
            {
              "id": "d90a9d69-868d-4e5b-8c73-7d5dc93acb5a",
              "name": "CONTA_CORRENTE",
              "value": "={{ $json.CONTA_CORRENTE }}",
              "type": "string"
            },
            {
              "id": "bf9da488-de06-418e-8283-6b9c83b67a99",
              "name": "Valor Desconto MDR",
              "value": "={{ $json['Valor Desconto MDR'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2016,
        -416
      ],
      "id": "f3dcde25-5ba2-4f80-a90a-4b80436bef43",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "jsCode": "// Mapeia a entrada para pegar apenas o JSON de cada item\nconst inputData = items.map(item => item.json);\n\nconst sums = {};\nconst finalItems = [];\n\n// 1. ITERAÇÃO E AGRUPAMENTO\ninputData.forEach((item, index) => {\n  try {\n    // --- Validação básica ---\n    if (!item[\"Data\"]) throw new Error(\"Campo 'Data' ausente.\");\n    \n    // Pegamos os valores auxiliares para repassar ao output\n    const categoria = item[\"CATEGORIA_A_PAGAR\"] || \"\";\n    const conta = item[\"CONTA_CORRENTE\"] || \"\";\n\n    if (item[\"Valor Desconto MDR\"] === undefined) throw new Error(\"Campo 'Valor Desconto MDR' ausente.\");\n\n    const data = item[\"Data\"];\n    const valorRaw = item[\"Valor Desconto MDR\"];\n    let valorFloat = 0.0;\n\n    // --- Tratamento de string/número ---\n    if (typeof valorRaw === 'string') {\n      const cleanValue = valorRaw.trim().replace(',', '.');\n      valorFloat = parseFloat(cleanValue);\n    } else if (typeof valorRaw === 'number') {\n      valorFloat = valorRaw;\n    } else {\n      throw new Error(`Formato desconhecido.`);\n    }\n\n    if (isNaN(valorFloat)) {\n      throw new Error(`Valor inválido: '${valorRaw}'`);\n    }\n\n    // --- Lógica de Agrupamento ---\n    if (!sums[data]) {\n      sums[data] = {\n        total: 0.0,\n        categoria: categoria,\n        conta: conta\n      };\n    }\n    \n    sums[data].total += valorFloat;\n\n  } catch (err) {\n    // SE DER ERRO: Adiciona à lista final como erro\n    finalItems.push({\n      json: {\n        tipo: \"ERRO\",\n        mensagem: err.message,\n        linha_original: index + 1,\n        dados_input: item\n      }\n    });\n  }\n});\n\n// 2. FORMATAÇÃO DOS SUCESSOS\nObject.keys(sums).forEach(data => {\n  const info = sums[data];\n\n  finalItems.push({\n    json: {\n      tipo: \"SUCESSO\",\n      \"Data\": data,\n      \"CATEGORIA_A_PAGAR\": info.categoria,\n      \"CONTA_CORRENTE\": info.conta,\n      \"Valor Total\": info.total.toFixed(2).replace('.', ',')\n    }\n  });\n});\n\n// 3. GERAÇÃO DO CÓDIGO SEQUENCIAL (APENAS SE FOR SUCESSO)\nlet contadorCodigo = 6;\n\nfinalItems.forEach(item => {\n    // Só adiciona o código se o tipo for SUCESSO\n    if (item.json.tipo === \"SUCESSO\") {\n        item.json.codigo = contadorCodigo;\n        contadorCodigo++; // Só incrementa se usou o número\n    }\n});\n\n// 4. RETORNO\nreturn finalItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2240,
        -416
      ],
      "id": "7477999c-14f2-4a50-a3db-4030fd8b2a91",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2528,
        -464
      ],
      "id": "9c1f0825-b967-496b-8076-22a9f8f564de",
      "name": "Merge1"
    },
    {
      "parameters": {
        "mode": "chooseBranch",
        "output": "empty"
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2368,
        -944
      ],
      "id": "ac69ea04-5573-44f7-84c0-a24b1b4f0712",
      "name": "Merge2"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('COPIA CONTAS A RECEBER').item.json.id }}",
          "mode": "id"
        },
        "options": {
          "binaryPropertyName": "data",
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
              "sheetsToFormat": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            }
          },
          "fileName": "={{ $('COPIA CONTAS A RECEBER').item.json.name }}.xlsx"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2640,
        -944
      ],
      "id": "2e031a12-0251-4ffc-b222-7bd7fa3416e7",
      "name": "Download file1",
      "executeOnce": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "tHbNUSv81dsDoIWb",
          "name": "Kybernan-BPO"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "binaryData": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2864,
        -944
      ],
      "id": "0e4c76e1-15aa-4ade-9498-8a0af9e8e3fc",
      "name": "Send a document1",
      "webhookId": "08b0fb0a-7902-40b7-b930-b5bd95042da8",
      "credentials": {
        "telegramApi": {
          "id": "jciBUUGqi15C8nzu",
          "name": "CONCILIADOR FINANCEIRO KYBERNAN"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $('COPIA CONTAS A RECEBER').item.json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Omie_Contas_Receber",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $json.codigo }}",
            "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)": "MERAKI CAFETERIA LTDA",
            "Categoria *": "={{ $json.CATEGORIA_A_RECEBER }}",
            "Conta Corrente *": "={{ $json.CONTA_CORRENTE }}",
            "Valor da Conta *": "={{ $json['Valor Liquido'] }}",
            "Data de Emissão": "={{ $json.Data }}",
            "Data de Registro *": "={{ $json.Data }}",
            "Data de Vencimento *": "={{ $json.Data }}",
            "Data de Previsão": "={{ $json.Data }}",
            "Data do Recebimento": "={{ $json.Data }}",
            "Valor do Recebimento": "={{ $json['Valor Liquido'] }}",
            "Data de Conciliação": "={{ $json.Data }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Código de Integração",
              "displayName": "Código de Integração",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
              "displayName": "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Categoria *",
              "displayName": "Categoria *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Conta Corrente *",
              "displayName": "Conta Corrente *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Valor da Conta *",
              "displayName": "Valor da Conta *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Vendedor",
              "displayName": "Vendedor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Projeto",
              "displayName": "Projeto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Data de Emissão",
              "displayName": "Data de Emissão",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Registro *",
              "displayName": "Data de Registro *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Vencimento *",
              "displayName": "Data de Vencimento *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Previsão",
              "displayName": "Data de Previsão",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data do Recebimento",
              "displayName": "Data do Recebimento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Valor do Recebimento",
              "displayName": "Valor do Recebimento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Juros",
              "displayName": "Juros",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Multa",
              "displayName": "Multa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Desconto",
              "displayName": "Desconto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Data de Conciliação",
              "displayName": "Data de Conciliação",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Observações",
              "displayName": "Observações",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Tipo de Documento",
              "displayName": "Tipo de Documento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Número do Documento",
              "displayName": "Número do Documento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Parcela",
              "displayName": "Parcela",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Total de Parcelas",
              "displayName": "Total de Parcelas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Número do Pedido",
              "displayName": "Número do Pedido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nota Fiscal",
              "displayName": "Nota Fiscal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Chave da NF-e",
              "displayName": "Chave da NF-e",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Código de Barras",
              "displayName": "Código de Barras",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Número do Boleto",
              "displayName": "Número do Boleto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "NSU / TID",
              "displayName": "NSU / TID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor PIS",
              "displayName": "Valor PIS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter PIS",
              "displayName": "Reter PIS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor COFINS",
              "displayName": "Valor COFINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter COFINS",
              "displayName": "Reter COFINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor CSLL",
              "displayName": "Valor CSLL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter CSLL",
              "displayName": "Reter CSLL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor IR",
              "displayName": "Valor IR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter IR",
              "displayName": "Reter IR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor ISS",
              "displayName": "Valor ISS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter ISS",
              "displayName": "Reter ISS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor INSS",
              "displayName": "Valor INSS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter INSS",
              "displayName": "Reter INSS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Departamento (100%)",
              "displayName": "Departamento (100%)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "locationDefine": {
            "values": {
              "headerRow": 5,
              "firstDataRow": 6
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2000,
        -1168
      ],
      "id": "3a82473b-2a8f-446c-8453-b2c8f807a5c0",
      "name": "ATUALIZA CONTAS A RECEBER2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ffefbe4a-be53-4288-9c0e-e451e0a8d6a3",
              "name": "codigo",
              "value": "={{ $itemIndex + 6 }}",
              "type": "string"
            },
            {
              "id": "b85346af-6438-4756-bbe2-3dcf69187791",
              "name": "Data",
              "value": "={{ $json.Data }}",
              "type": "string"
            },
            {
              "id": "6e6e1210-e61b-41f5-9a2d-e80f636a0912",
              "name": "CATEGORIA_A_PAGAR",
              "value": "={{ $json.CATEGORIA_A_PAGAR }}",
              "type": "string"
            },
            {
              "id": "65e83ee6-9765-4eba-b9da-03d55e308fe5",
              "name": "CATEGORIA_A_RECEBER",
              "value": "={{ $json.CATEGORIA_A_RECEBER }}",
              "type": "string"
            },
            {
              "id": "97189c39-6040-4443-8e4e-86c86bf3d32f",
              "name": "CONTA_CORRENTE",
              "value": "={{ $json.CONTA_CORRENTE }}",
              "type": "string"
            },
            {
              "id": "7e192e96-04dc-49fb-869f-1baf22953187",
              "name": "Valor Total",
              "value": "={{ $json['Valor Total'] }}",
              "type": "string"
            },
            {
              "id": "e076bc9d-4121-4de0-8a5e-4ffc3a2ce3ad",
              "name": "Valor Liquido",
              "value": "={{ $json['Valor Liquido'] }}",
              "type": "string"
            },
            {
              "id": "31bc6a0e-344f-4f15-a26e-3ad2d8cdb725",
              "name": "Valor Desconto MDR",
              "value": "={{ $json['Valor Desconto MDR'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1616,
        -1072
      ],
      "id": "c01118fe-87a8-495f-9a3f-14cec1068c0a",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $('COPIA CONTAS A RECEBER').item.json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Omie_Contas_Receber",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $json.codigo }}",
            "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)": "MERAKI CAFETERIA LTDA",
            "Categoria *": "={{ $json.CATEGORIA_A_RECEBER }}",
            "Conta Corrente *": "={{ $json.CONTA_CORRENTE }}",
            "Valor da Conta *": "={{ $json['Valor Total'] }}",
            "Data de Emissão": "={{ $json.Data }}",
            "Data de Registro *": "={{ $json.Data }}",
            "Data de Vencimento *": "={{ $json.Data }}",
            "Data de Previsão": "={{ $json.Data }}",
            "Data do Recebimento": "={{ $json.Data }}",
            "Valor do Recebimento": "={{ $json['Valor Total'] }}",
            "Data de Conciliação": "={{ $json.Data }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "Código de Integração",
              "displayName": "Código de Integração",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
              "displayName": "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Categoria *",
              "displayName": "Categoria *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Conta Corrente *",
              "displayName": "Conta Corrente *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Valor da Conta *",
              "displayName": "Valor da Conta *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Vendedor",
              "displayName": "Vendedor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Projeto",
              "displayName": "Projeto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Data de Emissão",
              "displayName": "Data de Emissão",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Registro *",
              "displayName": "Data de Registro *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Vencimento *",
              "displayName": "Data de Vencimento *",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data de Previsão",
              "displayName": "Data de Previsão",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Data do Recebimento",
              "displayName": "Data do Recebimento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Valor do Recebimento",
              "displayName": "Valor do Recebimento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Juros",
              "displayName": "Juros",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Multa",
              "displayName": "Multa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Desconto",
              "displayName": "Desconto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Data de Conciliação",
              "displayName": "Data de Conciliação",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Observações",
              "displayName": "Observações",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Tipo de Documento",
              "displayName": "Tipo de Documento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Número do Documento",
              "displayName": "Número do Documento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Parcela",
              "displayName": "Parcela",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Total de Parcelas",
              "displayName": "Total de Parcelas",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Número do Pedido",
              "displayName": "Número do Pedido",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nota Fiscal",
              "displayName": "Nota Fiscal",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Chave da NF-e",
              "displayName": "Chave da NF-e",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Código de Barras",
              "displayName": "Código de Barras",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Número do Boleto",
              "displayName": "Número do Boleto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "NSU / TID",
              "displayName": "NSU / TID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor PIS",
              "displayName": "Valor PIS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter PIS",
              "displayName": "Reter PIS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor COFINS",
              "displayName": "Valor COFINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter COFINS",
              "displayName": "Reter COFINS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor CSLL",
              "displayName": "Valor CSLL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter CSLL",
              "displayName": "Reter CSLL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor IR",
              "displayName": "Valor IR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter IR",
              "displayName": "Reter IR",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor ISS",
              "displayName": "Valor ISS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter ISS",
              "displayName": "Reter ISS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Valor INSS",
              "displayName": "Valor INSS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Reter INSS",
              "displayName": "Reter INSS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Departamento (100%)",
              "displayName": "Departamento (100%)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "locationDefine": {
            "values": {
              "headerRow": 5,
              "firstDataRow": 6
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2192,
        -784
      ],
      "id": "4a1eca1b-376b-482a-b36d-988c87f4bf27",
      "name": "ATUALIZA CONTAS A RECEBER3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "vwb992tcodcaklq5",
          "name": "KyberTech"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c6659db5-6047-43b5-a528-d16be2ca391c",
              "name": "codigo",
              "value": "={{ $('Edit Fields5').last().json.codigo }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1808,
        -992
      ],
      "id": "f2fa2428-ac94-4824-9f09-f297156aefd1",
      "name": "Edit Fields7",
      "executeOnce": true
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1824,
        -784
      ],
      "id": "2236114c-0cb2-437d-a14f-070582f3dd49",
      "name": "Merge3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c20cfa37-7640-416b-8277-8853c20df0cf",
              "name": "Data",
              "value": "={{ $json.Data }}",
              "type": "string"
            },
            {
              "id": "d55da94c-132c-4888-888d-a6803fcf9692",
              "name": "CATEGORIA_A_PAGAR",
              "value": "={{ $json.CATEGORIA_A_PAGAR }}",
              "type": "string"
            },
            {
              "id": "96401f77-f04d-4b38-bc6e-04d67cd22676",
              "name": "CATEGORIA_A_RECEBER",
              "value": "={{ $json.CATEGORIA_A_RECEBER }}",
              "type": "string"
            },
            {
              "id": "8bc6fa7a-ee87-425e-bdc8-3a18e02c5d1e",
              "name": "CONTA_CORRENTE",
              "value": "={{ $json.CONTA_CORRENTE }}",
              "type": "string"
            },
            {
              "id": "898175be-7402-4ebf-847e-73f4eba0754d",
              "name": "Valor Total",
              "value": "={{ $json['Valor Total'] }}",
              "type": "string"
            },
            {
              "id": "7e593959-aa41-48db-b08e-a70af50d30da",
              "name": "Valor Liquido",
              "value": "={{ $json['Valor Liquido'] }}",
              "type": "string"
            },
            {
              "id": "3d3ddef5-1a60-423d-818b-93fadc6da907",
              "name": "Valor Desconto MDR",
              "value": "={{ $json['Valor Desconto MDR'] }}",
              "type": "string"
            },
            {
              "id": "bfd0890c-5cf6-44ad-9e44-e056808d20a1",
              "name": "codigo",
              "value": "={{ $itemIndex + 1 + ($('Edit Fields7').isExecuted ? $('Edit Fields7').item.json.codigo : 5) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2000,
        -784
      ],
      "id": "80f7f73b-648c-47b6-98ea-5a19679212b0",
      "name": "Edit Fields8"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "d4c6dc0b-165e-45ca-a0ec-c8249965cd2a",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1360,
        -1056
      ],
      "id": "15c635a8-fa1b-4331-ace1-0199a1581bd6",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "binaryPropertyName": "={{ $('Telegram Trigger').item.binary.data }}",
        "options": {
          "headerRow": true,
          "range": "7"
        }
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -912,
        -592
      ],
      "id": "358cb101-415e-4de0-90d6-0441b5e5c687",
      "name": "Extract from File3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "97a88027-fb5b-4f04-b307-bd794daf3b83",
              "name": "DATA DA VENDA",
              "value": "={{ $json['DATA/HORA DA VENDA'].split(' ')[0] }}",
              "type": "string"
            },
            {
              "id": "2acc3632-75e2-457a-8053-d0d4113aa1f4",
              "name": "PRODUTO",
              "value": "={{ $json.MODALIDADE }}",
              "type": "string"
            },
            {
              "id": "e35c48e8-5eec-4889-8f1d-f903f44c57c2",
              "name": "VALOR BRUTO",
              "value": "={{ $json['VALOR BRUTO'] }}",
              "type": "number"
            },
            {
              "id": "e35ebb0b-8f5e-4537-9f7f-8318fa25a71f",
              "name": "VALOR LIQUIDO",
              "value": "={{ $json['VALOR LÍQUIDO'] }}",
              "type": "number"
            },
            {
              "id": "a0c1019d-6978-4fc0-8cb0-6c9b0de1703d",
              "name": "DESCONTO DE MDR",
              "value": "={{ $json['VALOR TAXA'] }}",
              "type": "number"
            },
            {
              "id": "25feee2d-d497-45b9-b6ef-19ec479bf499",
              "name": "ULTIMO STATUS",
              "value": "={{ $json['STATUS DA TRANSAÇÃO'] }}",
              "type": "string"
            },
            {
              "id": "1daa56c0-1798-4869-96d6-c51575ae735c",
              "name": "BANDEIRA",
              "value": "={{ $json.BANDEIRA }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -704,
        -592
      ],
      "id": "e8254324-bc1c-4d3e-9dd1-a437b45c93f0",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "69644f4c-051e-407f-9a6c-1c2c182c5e8d",
              "leftValue": "={{ $json['ULTIMO STATUS'] }}",
              "rightValue": "Aprovada",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "13bcb585-b4d2-42c6-8349-427fd57debbf",
              "leftValue": "={{ $json['ULTIMO STATUS'] }}",
              "rightValue": "aprovado",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -48,
        -720
      ],
      "id": "4914939d-338c-47c6-89ff-ee23ab642a1d",
      "name": "aprovada?"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Encontrei {{ $input.all().length }} transações que não foram aprovadas.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        80,
        -416
      ],
      "id": "b83693eb-dd18-446d-a024-16e9233005d1",
      "name": "Send a text message",
      "webhookId": "08b0fb0a-7902-40b7-b930-b5bd95042da8",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "jciBUUGqi15C8nzu",
          "name": "CONCILIADOR FINANCEIRO KYBERNAN"
        }
      }
    },
    {
      "parameters": {
        "content": "## GERA O ARQUIVO DE OUTPUT DEPENDENDO DO SISTEMA DA EMPRESA SÓ COM O QUE PRECISA SER LANÇADO\n",
        "height": 432
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        768,
        -128
      ],
      "id": "295f0aa7-0e13-4525-a6a7-9fbb308acfc4",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "=Encontrei {{ $input.all().length }} transações que deram erro, avisar Bruno para verificar.",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        768,
        -560
      ],
      "id": "9f571527-b405-475e-810d-101bfc50c8ec",
      "name": "Send a text message1",
      "webhookId": "08b0fb0a-7902-40b7-b930-b5bd95042da8",
      "executeOnce": true,
      "credentials": {
        "telegramApi": {
          "id": "jciBUUGqi15C8nzu",
          "name": "CONCILIADOR FINANCEIRO KYBERNAN"
        }
      }
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-3-flash-preview",
          "mode": "list",
          "cachedResultName": "models/gemini-3-flash-preview"
        },
        "text": "=# Role (Papel)\n* Analisar a imagem extraindo informações de vendas no crédito, débito e pix.\n\n# Context\n* Em uma imagem vai ter um ou mais relatórios de vendas de maquininha de cartão de crédito da pagseguro com o total de credito, débito e às vezes pix e a data\n\n# Task\n\n## Etapa 1\n* Identifique quantos cupons de relatório tem, cada cupom será de um dia diferente, identifique a data de cada cupom\n\n## Etapa 2\n* Extraia as seguintes informações de cada um dos cupons\n* Data, valor total do credito, valor total do debito, valor total do pix\n* Ignore os subtotais, extraindo apenas os totais de categoria e a data\n\n## Etapa 3\n\n* Apresente os dados extraídos seguindo exatamente este formato para cada cupom identificado:\n\"📊 Relatório de Vendas - [INSERIR DATA]\n\nData: [DD/MM/AAAA]\nCrédito Total: R$ [0,00]\nDébito Total: R$ [0,00]\nPIX Total: R$ [0,00]\"\n\n# Rules\n* Não erre os valores, tenha certeza absoluta de informar as datas e totais corretamente.\n* Analise corretamente a data e o ANO também, para não errar dizendo que é de 2023 sendo que na verdade é de 2026, normalmente a data será de 2025 / 2026 em diante, nunca será 2024 para trás.\n* Nunca confunda o total efetivado com o total de credito, debito ou pix\n* Não extraia o valor de total efetivado, apenas total de credito, debito e pix\n* Tenha certeza ABSOLUTA e confirme que o valor extraído está 100% correto, valor exato, inclusive os centavos, faça um ocr bem feito, um copia e cola exato.\n* NÃO EXTRAIA O TOTAL EFETIVADO.",
        "inputType": "binary",
        "binaryPropertyName": "=data",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1.1,
      "position": [
        -704,
        -256
      ],
      "id": "ccd8b7f2-8c72-4f85-9087-5eb85558a171",
      "name": "Analyze an image",
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "maxTries": 2,
      "credentials": {
        "googlePalmApi": {
          "id": "wfEWNV7ZmLlccItk",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e956ea32-d9c6-4ef4-9c5e-69ae7c03d06b",
              "name": "=data",
              "value": "={{ $('Telegram Trigger').item.binary.data }}",
              "type": "binary"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -912,
        -256
      ],
      "id": "bc6a8e1d-96f1-4e4a-9250-f424699a1624",
      "name": "Edit Fields9"
    },
    {
      "parameters": {
        "text": "={{ $json.content.parts[0].text }}",
        "schemaType": "fromJson",
        "jsonSchemaExample": "[\n  {\n    \"DATA DA VENDA\": \"12/01/2026\",\n    \"PRODUTO\": \"Crédito\",\n    \"VALOR BRUTO\": 1680.75,\n    \"ULTIMO STATUS\": \"Aprovado\"\n  },\n  {\n    \"DATA DA VENDA\": \"12/01/2026\",\n    \"PRODUTO\": \"Débito\",\n    \"VALOR BRUTO\": 85.00,\n    \"ULTIMO STATUS\": \"Aprovado\"\n  },\n  {\n    \"DATA DA VENDA\": \"12/01/2026\",\n    \"PRODUTO\": \"Pix\",\n    \"VALOR BRUTO\": 210.00,\n    \"ULTIMO STATUS\": \"Concluído\"\n  }\n]",
        "options": {
          "systemPromptTemplate": "=# Prompt\n\n**Papel:**\nVocê é um algoritmo especialista em extração de dados e processamento de documentos fiscais e relatórios de vendas. Sua tarefa é analisar o texto/imagem e converter as informações em um formato estruturado JSON.\n\n**Diretrizes de Extração:**\n\n1. **Foco:** Extraia apenas as informações relevantes solicitadas. Se não encontrar o valor de um atributo, omita o campo ou retorne nulo.\n2. **Regra do PIX:** Só extraia a categoria \"PIX\" se o valor total for maior que zero. Se for zero, ignore essa entrada.\n3. **Status Fixo:** O campo `ULTIMO STATUS` deve ser sempre preenchido como `\"aprovado\"`.\n4. **Não Agregação:** Não some os valores de diferentes tipos de transação e datas. Cada tipo de produto e data deve ter sua própria entrada no array.\n\n**Estrutura de Saída:**\nGere um **array de objetos** onde a data deve ser repetida para cada tipo de produto encontrado no relatório. Os valores permitidos para o campo `PRODUTO` são apenas: `\"credito\"`, `\"debito\"` ou `\"PIX\"`."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "typeVersion": 1.2,
      "position": [
        -912,
        -16
      ],
      "id": "45ca0d75-71d0-42a1-ab46-f2e1eb635e28",
      "name": "Information Extractor"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -864,
        160
      ],
      "id": "8327a409-a703-4d7f-bd37-e3ab05c446e5",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "fRrIyxCKgTlReSWb",
          "name": "Kybernan-Arquivador"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "output",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -608,
        -16
      ],
      "id": "1022c66a-9541-410f-b724-ea2b4e873971",
      "name": "Split Out"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "970c8fe2-1695-4dd0-8073-61fb7cd0f8c1",
              "name": "DATA DA VENDA",
              "value": "={{ $json['DATA DA VENDA'] }}",
              "type": "string"
            },
            {
              "id": "52499be6-ad8e-4a03-92e1-056d7bbe32b2",
              "name": "PRODUTO",
              "value": "={{ $json.PRODUTO }}",
              "type": "string"
            },
            {
              "id": "85bb24c5-b4d1-4799-90d3-8c3da56e287b",
              "name": "VALOR BRUTO",
              "value": "={{ $json['VALOR BRUTO'] }}",
              "type": "number"
            },
            {
              "id": "5ff4548e-af5f-4d0d-a0e0-16000fbd3d28",
              "name": "VALOR LIQUIDO",
              "value": "={{ $json['VALOR BRUTO'] - (['credito', 'crédito'].includes($json.PRODUTO.toLowerCase()) ? $json['VALOR BRUTO'] * 0.055 : $json['VALOR BRUTO'] * 0.045).toFixed(2) }}",
              "type": "number"
            },
            {
              "id": "13a59c9c-049d-4651-aa65-a333e0e21534",
              "name": "DESCONTO DE MDR",
              "value": "={{ (['credito', 'crédito'].includes($json.PRODUTO.toLowerCase()) ? $json['VALOR BRUTO'] * 0.055 : $json['VALOR BRUTO'] * 0.045).toFixed(2) }}",
              "type": "number"
            },
            {
              "id": "3ef36e11-ee76-4fea-8ae5-2c6efd38d8ec",
              "name": "ULTIMO STATUS",
              "value": "={{ $json['ULTIMO STATUS'] }}",
              "type": "string"
            },
            {
              "id": "ecded5dc-749b-4191-8270-78e88c4bef2f",
              "name": "MAQUININHA",
              "value": "={{ $('Send message and wait for response1').item.json.data['Qual maquininha?'] }}",
              "type": "string"
            },
            {
              "id": "07af5b79-9b3e-4c20-b4be-027bad61f814",
              "name": "data['Qual empresa?']",
              "value": "={{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }}",
              "type": "string"
            },
            {
              "id": "7fab4c36-6f4c-4f42-8c65-2139d58938f8",
              "name": "BANDEIRA",
              "value": "={{ $json.PRODUTO }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -400,
        -240
      ],
      "id": "3a203f49-41b3-4102-8b07-3f59c279e6d0",
      "name": "Edit Fields10"
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Send message and wait for response1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        []
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send message and wait for response1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from File3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from File2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File1": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File2": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "COPIA CONTAS A PAGAR",
            "type": "main",
            "index": 0
          },
          {
            "node": "aprovada?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "ERRO?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "COPIA CONTAS A PAGAR": {
      "main": [
        [
          {
            "node": "COPIA CONTAS A RECEBER",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "voucher / ticket",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "COPIA CONTAS A RECEBER": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ERRO?": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ATUALIZA CONTAS A PAGAR": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "voucher / ticket": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge3",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Send a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "ATUALIZA CONTAS A PAGAR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file1": {
      "main": [
        [
          {
            "node": "Send a document1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Download file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ATUALIZA CONTAS A RECEBER2": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "ATUALIZA CONTAS A RECEBER2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields7": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Edit Fields8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields8": {
      "main": [
        [
          {
            "node": "ATUALIZA CONTAS A RECEBER3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ATUALIZA CONTAS A RECEBER3": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File3": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "aprovada?": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields9": {
      "main": [
        [
          {
            "node": "Analyze an image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze an image": {
      "main": [
        [
          {
            "node": "Information Extractor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Information Extractor",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Information Extractor": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Edit Fields10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields10": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Telegram Trigger": [
      {
        "json": {
          "update_id": 905783672,
          "message": {
            "message_id": 215,
            "from": {
              "id": 5399986688,
              "is_bot": false,
              "first_name": "Bruno",
              "last_name": "Ferreira",
              "username": "brunopfer",
              "language_code": "pt-br"
            },
            "chat": {
              "id": 5399986688,
              "first_name": "Bruno",
              "last_name": "Ferreira",
              "username": "brunopfer",
              "type": "private"
            },
            "date": 1768226087,
            "forward_origin": {
              "type": "user",
              "sender_user": {
                "id": 5399986688,
                "is_bot": false,
                "first_name": "Bruno",
                "last_name": "Ferreira",
                "username": "brunopfer",
                "language_code": "pt-br"
              },
              "date": 1768225990
            },
            "forward_from": {
              "id": 5399986688,
              "is_bot": false,
              "first_name": "Bruno",
              "last_name": "Ferreira",
              "username": "brunopfer",
              "language_code": "pt-br"
            },
            "forward_date": 1768225990,
            "document": {
              "file_name": "WhatsApp Image 2026-01-08 at 14.42.04.jpeg",
              "mime_type": "image/jpeg",
              "thumbnail": {
                "file_id": "AAMCAQADGQEAA9VpZPzGu1C6JlKdOnk1HtW9mL2PTAACeAUAApDaKEdhI7hp1A3n_QEAB20AAzgE",
                "file_unique_id": "AQADeAUAApDaKEdy",
                "file_size": 13289,
                "width": 180,
                "height": 320
              },
              "thumb": {
                "file_id": "AAMCAQADGQEAA9VpZPzGu1C6JlKdOnk1HtW9mL2PTAACeAUAApDaKEdhI7hp1A3n_QEAB20AAzgE",
                "file_unique_id": "AQADeAUAApDaKEdy",
                "file_size": 13289,
                "width": 180,
                "height": 320
              },
              "file_id": "BQACAgEAAxkBAAPVaWT8xrtQuiZSnTp5NR7VvZi9j0wAAngFAAKQ2ihHYSO4adQN5_04BA",
              "file_unique_id": "AgADeAUAApDaKEc",
              "file_size": 190257
            }
          }
        },
        "binary": {
          "data": {
            "mimeType": "image/jpeg",
            "fileType": "image",
            "fileExtension": "jpeg",
            "data": "database",
            "fileName": "file_39.jpeg",
            "id": "database:b80a85a0-8469-461f-9de2-439ddc798fdc",
            "fileSize": "190 kB"
          }
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "versionId": "2f3cd67b-cf8a-4a33-81bc-0771a892c1b9",
  "activeVersionId": "2f3cd67b-cf8a-4a33-81bc-0771a892c1b9",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-12-17T13:27:06.794Z",
      "createdAt": "2025-12-17T13:27:06.794Z",
      "role": "workflow:owner",
      "workflowId": "4UU0wSZDCfVD5mHs",
      "projectId": "72MghKyBe7pL4bex"
    }
  ],
  "activeVersion": {
    "updatedAt": "2026-01-12T15:45:27.151Z",
    "createdAt": "2026-01-12T15:45:23.468Z",
    "versionId": "2f3cd67b-cf8a-4a33-81bc-0771a892c1b9",
    "workflowId": "4UU0wSZDCfVD5mHs",
    "nodes": [
      {
        "parameters": {
          "content": "## TRIGGER TELEGRAM\nPERGUNTANDO DE QUAL EMPRESA É",
          "height": 448,
          "width": 448
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1840,
          -784
        ],
        "id": "6ae793e5-2109-4347-9b82-40406df0c0ac",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "## LÊ E ENTENDE OS DADOS E INTERPRETA GERANDO UM ARRAY\n",
          "height": 784,
          "width": 560
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1024,
          -1056
        ],
        "id": "221bd780-b3ec-4a54-b013-98682ff3fba4",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "content": "## NORMALIZA OS DADOS PARA FICAREM PADRONIZADOS INDEPENDENTE DA FORMA QUE CHEGAR",
          "height": 464,
          "width": 448
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -352,
          -928
        ],
        "id": "8e8559de-aa26-4265-ada9-ab5185a6e90e",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "content": "## IDENTIFICA A EMPRESA E SEU RESPECTIVO SISTEMA E API PELO BANCO DE DADOS",
          "height": 432,
          "width": 336
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -128,
          -144
        ],
        "id": "404c6300-2687-4219-b563-acfc86cdc17b",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "content": "## LANÇA NA API DO SISTEMA CORRETO COM AS CREDENCIAIS",
          "height": 432
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1056,
          -144
        ],
        "id": "b8641eb4-3e9c-437e-9d0d-4f1907150ca7",
        "name": "Sticky Note5"
      },
      {
        "parameters": {
          "content": "## verifica no sistema do cliente os que já estão lançados e faz um MERGE para validar o que realmente precisa ser lançado\n",
          "height": 432,
          "width": 416
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          288,
          -144
        ],
        "id": "b39e1eb5-9861-4fc3-b556-14b5461269f0",
        "name": "Sticky Note6"
      },
      {
        "parameters": {
          "updates": [
            "message"
          ],
          "additionalFields": {
            "download": true
          }
        },
        "type": "n8n-nodes-base.telegramTrigger",
        "typeVersion": 1.2,
        "position": [
          -1792,
          -608
        ],
        "id": "ec06b256-d852-4dff-9829-d80dcca7459c",
        "name": "Telegram Trigger",
        "webhookId": "079e735b-3442-46a2-8149-bfe1300a9e49",
        "credentials": {
          "telegramApi": {
            "id": "jciBUUGqi15C8nzu",
            "name": "CONCILIADOR FINANCEIRO KYBERNAN"
          }
        }
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "K29Z4unzBhzw2kCh",
            "mode": "list",
            "cachedResultName": "CadastroClientesSistemaAPI",
            "cachedResultUrl": "/projects/72MghKyBe7pL4bex/datatables/K29Z4unzBhzw2kCh"
          },
          "filters": {
            "conditions": [
              {
                "keyName": "NOME",
                "keyValue": "={{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }}"
              }
            ]
          },
          "returnAll": true
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1,
        "position": [
          -16,
          80
        ],
        "id": "b09631a6-291b-4c95-a877-3c18086e6216",
        "name": "Get row(s)"
      },
      {
        "parameters": {
          "operation": "xlsx",
          "binaryPropertyName": "={{ $('Telegram Trigger').item.binary.data }}",
          "options": {
            "headerRow": true,
            "range": "9"
          }
        },
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1.1,
        "position": [
          -896,
          -960
        ],
        "id": "279c6ea1-0693-4b85-959a-511b8d13f90b",
        "name": "Extract from File"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "97a88027-fb5b-4f04-b307-bd794daf3b83",
                "name": "DATA DA VENDA",
                "value": "={{ $json['Data da venda'] }}",
                "type": "string"
              },
              {
                "id": "2acc3632-75e2-457a-8053-d0d4113aa1f4",
                "name": "PRODUTO",
                "value": "={{ $json['Forma de pagamento'] }}",
                "type": "string"
              },
              {
                "id": "e35c48e8-5eec-4889-8f1d-f903f44c57c2",
                "name": "VALOR BRUTO",
                "value": "={{ $json['Valor bruto'] }}",
                "type": "number"
              },
              {
                "id": "e35ebb0b-8f5e-4537-9f7f-8318fa25a71f",
                "name": "VALOR LIQUIDO",
                "value": "={{ $json['Valor líquido'] }}",
                "type": "number"
              },
              {
                "id": "a0c1019d-6978-4fc0-8cb0-6c9b0de1703d",
                "name": "DESCONTO DE MDR",
                "value": "={{ $json['Taxa/tarifa'] }}",
                "type": "number"
              },
              {
                "id": "25feee2d-d497-45b9-b6ef-19ec479bf499",
                "name": "ULTIMO STATUS",
                "value": "={{ $json['Status da venda'] }}",
                "type": "string"
              },
              {
                "id": "0401d747-e989-407a-9d03-1b01bc15f605",
                "name": "BANDEIRA",
                "value": "",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -704,
          -960
        ],
        "id": "0bf96110-9781-4bf9-9f18-1fff77d95cf6",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "operation": "sendAndWait",
          "chatId": "={{ $json.message.chat.id }}",
          "message": "Qual maquininha?",
          "responseType": "customForm",
          "formFields": {
            "values": [
              {
                "fieldLabel": "Qual maquininha?",
                "fieldType": "dropdown",
                "fieldOptions": {
                  "values": [
                    {
                      "option": "Stone"
                    },
                    {
                      "option": "Cielo"
                    },
                    {
                      "option": "Azulzinha"
                    },
                    {
                      "option": "GetNet"
                    },
                    {
                      "option": "PagSeguro"
                    }
                  ]
                },
                "requiredField": true
              },
              {
                "fieldLabel": "Qual empresa?",
                "fieldType": "dropdown",
                "fieldOptions": {
                  "values": [
                    {
                      "option": "MERAKI"
                    },
                    {
                      "option": "OUTRAS (TESTE)"
                    }
                  ]
                },
                "requiredField": true
              }
            ]
          },
          "options": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          -1600,
          -608
        ],
        "id": "f1ca364d-734f-4151-903f-73651f535e84",
        "name": "Send message and wait for response1",
        "webhookId": "d896def6-dd5c-438a-8454-be8560926a32",
        "credentials": {
          "telegramApi": {
            "id": "jciBUUGqi15C8nzu",
            "name": "CONCILIADOR FINANCEIRO KYBERNAN"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                      "rightValue": "Cielo",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "ed0b9f5f-7698-4f6d-9450-26b398878a22"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Cielo"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "046d0f00-6b1c-4c87-9fc2-17288e7fef0f",
                      "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                      "rightValue": "Azulzinha",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Azulzinha"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "596d426f-b7b8-43d8-995c-3299bd538406",
                      "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                      "rightValue": "GetNet",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "GetNet"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "c47fd869-0e16-43fe-8e37-a2b6512feef3",
                      "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                      "rightValue": "Stone",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Stone"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "976439c0-c3fd-4ff0-b88d-54585c556076",
                      "leftValue": "={{ $json.data['Qual maquininha?'] }}",
                      "rightValue": "PagSeguro",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "PagSeguro"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -1280,
          -640
        ],
        "id": "fa7a3bde-4f08-4658-acec-341bbeb54de9",
        "name": "Switch"
      },
      {
        "parameters": {
          "operation": "xlsx",
          "binaryPropertyName": "={{ $('Telegram Trigger').item.binary.data }}",
          "options": {
            "headerRow": true,
            "range": "4"
          }
        },
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1.1,
        "position": [
          -896,
          -784
        ],
        "id": "ffd20005-4fe9-4d36-b9fa-c985a6fd976e",
        "name": "Extract from File1"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "97a88027-fb5b-4f04-b307-bd794daf3b83",
                "name": "DATA DA VENDA",
                "value": "={{ $json['Data da venda'] }}",
                "type": "string"
              },
              {
                "id": "2acc3632-75e2-457a-8053-d0d4113aa1f4",
                "name": "PRODUTO",
                "value": "={{ $json.Produto }}",
                "type": "string"
              },
              {
                "id": "e35c48e8-5eec-4889-8f1d-f903f44c57c2",
                "name": "VALOR BRUTO",
                "value": "={{ $json['Valor bruto da transação'] }}",
                "type": "number"
              },
              {
                "id": "e35ebb0b-8f5e-4537-9f7f-8318fa25a71f",
                "name": "VALOR LIQUIDO",
                "value": "={{ $json['Valor líquido da parcela/transação'] }}",
                "type": "number"
              },
              {
                "id": "a0c1019d-6978-4fc0-8cb0-6c9b0de1703d",
                "name": "DESCONTO DE MDR",
                "value": "={{ $json['Valor da taxa (MDR)'] }}",
                "type": "number"
              },
              {
                "id": "25feee2d-d497-45b9-b6ef-19ec479bf499",
                "name": "ULTIMO STATUS",
                "value": "={{ $json['Status do pagamento da venda'] }}",
                "type": "string"
              },
              {
                "id": "1daa56c0-1798-4869-96d6-c51575ae735c",
                "name": "BANDEIRA",
                "value": "",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -704,
          -784
        ],
        "id": "709559e1-eb18-4ac5-9eac-db37d14ee326",
        "name": "Edit Fields1"
      },
      {
        "parameters": {
          "operation": "xlsx",
          "binaryPropertyName": "={{ $('Telegram Trigger').item.binary.data }}",
          "options": {
            "headerRow": true,
            "range": "0"
          }
        },
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1.1,
        "position": [
          -912,
          -432
        ],
        "id": "4d1b41b1-d846-4393-aad2-1ea00e9a34c1",
        "name": "Extract from File2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "97a88027-fb5b-4f04-b307-bd794daf3b83",
                "name": "DATA DA VENDA",
                "value": "={{ $json['DATA DA VENDA'].split(' ')[0] }}",
                "type": "string"
              },
              {
                "id": "2acc3632-75e2-457a-8053-d0d4113aa1f4",
                "name": "PRODUTO",
                "value": "={{ $json.PRODUTO }}",
                "type": "string"
              },
              {
                "id": "e35c48e8-5eec-4889-8f1d-f903f44c57c2",
                "name": "VALOR BRUTO",
                "value": "={{ parseFloat($json['VALOR BRUTO'].replace(',', '.')) }}",
                "type": "number"
              },
              {
                "id": "e35ebb0b-8f5e-4537-9f7f-8318fa25a71f",
                "name": "VALOR LIQUIDO",
                "value": "={{ parseFloat($json['VALOR LIQUIDO'].replace(',', '.')) }}",
                "type": "number"
              },
              {
                "id": "a0c1019d-6978-4fc0-8cb0-6c9b0de1703d",
                "name": "DESCONTO DE MDR",
                "value": "={{ parseFloat($json['DESCONTO DE MDR'].replace(',', '.')) }}",
                "type": "number"
              },
              {
                "id": "25feee2d-d497-45b9-b6ef-19ec479bf499",
                "name": "ULTIMO STATUS",
                "value": "={{ $json['ULTIMO STATUS'] }}",
                "type": "string"
              },
              {
                "id": "23c1af1c-f0bd-425c-8c05-4d820573157d",
                "name": "BANDEIRA",
                "value": "={{ $json.BANDEIRA }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -704,
          -432
        ],
        "id": "005e9e4d-98a1-47e9-972d-ad53c9325b41",
        "name": "Edit Fields2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "970c8fe2-1695-4dd0-8073-61fb7cd0f8c1",
                "name": "DATA DA VENDA",
                "value": "={{ $json['DATA DA VENDA'] }}",
                "type": "string"
              },
              {
                "id": "52499be6-ad8e-4a03-92e1-056d7bbe32b2",
                "name": "PRODUTO",
                "value": "={{ $json.PRODUTO }}",
                "type": "string"
              },
              {
                "id": "85bb24c5-b4d1-4799-90d3-8c3da56e287b",
                "name": "VALOR BRUTO",
                "value": "={{ $json['VALOR BRUTO'] }}",
                "type": "number"
              },
              {
                "id": "5ff4548e-af5f-4d0d-a0e0-16000fbd3d28",
                "name": "VALOR LIQUIDO",
                "value": "={{ $json['VALOR LIQUIDO'] }}",
                "type": "number"
              },
              {
                "id": "13a59c9c-049d-4651-aa65-a333e0e21534",
                "name": "DESCONTO DE MDR",
                "value": "={{ $json['DESCONTO DE MDR'] }}",
                "type": "number"
              },
              {
                "id": "3ef36e11-ee76-4fea-8ae5-2c6efd38d8ec",
                "name": "ULTIMO STATUS",
                "value": "={{ $json['ULTIMO STATUS'] }}",
                "type": "string"
              },
              {
                "id": "ecded5dc-749b-4191-8270-78e88c4bef2f",
                "name": "MAQUININHA",
                "value": "={{ $('Send message and wait for response1').item.json.data['Qual maquininha?'] }}",
                "type": "string"
              },
              {
                "id": "07af5b79-9b3e-4c20-b4be-027bad61f814",
                "name": "data['Qual empresa?']",
                "value": "={{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }}",
                "type": "string"
              },
              {
                "id": "7fab4c36-6f4c-4f42-8c65-2139d58938f8",
                "name": "BANDEIRA",
                "value": "={{ $json.BANDEIRA }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -304,
          -720
        ],
        "id": "5a6ed770-effe-4aa4-a48e-e178d635e8bd",
        "name": "Edit Fields3"
      },
      {
        "parameters": {
          "jsCode": "// Função auxiliar para formatar moeda (ex: 1234.56 -> \"1234,56\")\nfunction formatCurrency(value) {\n    return value.toFixed(2).replace('.', ',');\n}\n\n// Armazena os dados agrupados (Sucesso)\nconst groupedData = {};\n// Armazena as linhas com erro (Falha)\nconst errorItems = [];\n\n// Lista de Bandeiras que consideramos como Vouchers/Tickets\nconst voucherFlags = [\"ticket\", \"alelo\", \"vr\", \"sodexo\", \"verocard\", \"verocheque\", \"vegascard\", \"pluxee\", \"confarma\"];\n\n// Itera sobre todos os itens recebidos\nfor (const item of items) {\n    const json = item.json;\n\n    // --- 1. EXTRAÇÃO DE DADOS ---\n    const rawDate = json[\"DATA DA VENDA\"];\n    \n    // Tratamento de Valores: Garante positivo (Math.abs) e número\n    const rawValBruto = Math.abs(parseFloat(json[\"VALOR BRUTO\"] || 0)); \n    const rawValLiquido = Math.abs(parseFloat(json[\"VALOR LIQUIDO\"] || 0)); \n    const rawValMdr = Math.abs(parseFloat(json[\"DESCONTO DE MDR\"] || 0)); \n    \n    const produtoRaw = (json[\"PRODUTO\"] || \"\").trim();\n    const produto = produtoRaw.toLowerCase();\n    \n    const maquininhaRaw = (json[\"MAQUININHA\"] || \"\").trim();\n    const maquininha = maquininhaRaw.toLowerCase();\n    \n    const bandeiraRaw = (json[\"BANDEIRA\"] || \"\").trim();\n    const bandeira = bandeiraRaw.toLowerCase();\n\n    // --- 2. LÓGICA DA CATEGORIA A RECEBER ---\n    let categoriaReceber = \"A DEFINIR\";\n\n    const isPix = produto.includes(\"pix\");\n    const isDebito = produto.includes(\"debito\") || produto.includes(\"débito\");\n    const isCredito = produto.includes(\"credito\") || produto.includes(\"crédito\");\n    const isVoucher = produto.includes(\"voucher\") || voucherFlags.some(flag => bandeira.includes(flag));\n\n    if (isPix) {\n        if (maquininha.includes(\"stone\")) categoriaReceber = \"Recebimento por Maquininha STONE  Pix\";\n        else if (maquininha.includes(\"pagseguro\")) categoriaReceber = \"Recebimento por Maquininha PAGSEGURO Pix\";\n        else categoriaReceber = \"Recebimento por PIX\";\n    } \n    else if (isVoucher) {\n        // Conforme solicitado, Vouchers vão para esta categoria\n        categoriaReceber = \"Recebimento por Maquininha TICKET\";\n    }\n    else if (isDebito) {\n        if (maquininha.includes(\"getnet\")) categoriaReceber = \"Recebimento por Maquininha GETNET Débito\";\n        else if (maquininha.includes(\"stone\")) categoriaReceber = \"Recebimento por Maquininha STONE  Débito\";\n        else if (maquininha.includes(\"cielo\")) categoriaReceber = \"Recebimento por Maquininha CIELO Débito\";\n        else if (maquininha.includes(\"azulzinha\")) categoriaReceber = \"Recebimento por Maquininha AZULZINHA Débito\";\n        else if (maquininha.includes(\"pagseguro\")) categoriaReceber = \"Recebimento por Maquininha PAGSEGURO Débito\";\n    }\n    else if (isCredito) {\n        if (maquininha.includes(\"getnet\")) categoriaReceber = \"Recebimento por Maquininha GETNET Crédito\";\n        else if (maquininha.includes(\"stone\")) categoriaReceber = \"Recebimento por Maquininha STONE Crédito\";\n        else if (maquininha.includes(\"cielo\")) categoriaReceber = \"Recebimento por Maquininha CIELO Crédito\";\n        else if (maquininha.includes(\"azulzinha\")) categoriaReceber = \"Recebimento por Maquininha AZULZINHA Crédito\";\n        else if (maquininha.includes(\"pagseguro\")) categoriaReceber = \"Recebimento por Maquininha PAGSEGURO Crédito\";\n    }\n\n    // --- 3. LÓGICA DA CONTA CORRENTE ---\n    let contaCorrente = \"A DEFINIR\";\n\n    if (isVoucher) {\n        if (bandeira.includes(\"alelo\")) contaCorrente = \"Alelo\";\n        else if (bandeira.includes(\"vr\")) contaCorrente = \"VR\";\n        else if (bandeira.includes(\"ticket\")) contaCorrente = \"Ticket\";\n        else if (bandeira.includes(\"pluxee\")) contaCorrente = \"Pluxee\";\n        else if (bandeira.includes(\"vegascard\")) contaCorrente = \"VEGASCARD\";\n        else if (bandeira.includes(\"verocheque\") || bandeira.includes(\"verocard\")) contaCorrente = \"VEROCHEQUE\"; \n        else if (bandeira.includes(\"confarma\")) contaCorrente = \"CONFARMA\";\n        // REGRA NOVA ADICIONADA AQUI:\n        else if (bandeira.includes(\"elo\")) contaCorrente = \"GetNet\";\n    } else {\n        if (maquininha.includes(\"stone\")) contaCorrente = \"Stone\";\n        else if (maquininha.includes(\"getnet\")) contaCorrente = \"GetNet\";\n        else if (maquininha.includes(\"cielo\")) contaCorrente = \"CIELO\";\n        else if (maquininha.includes(\"pagseguro\")) contaCorrente = \"PagSeguro\";\n        else if (maquininha.includes(\"azulzinha\")) contaCorrente = \"Azulzinha (Caixa Econômica Federal)\";\n        else if (maquininha.includes(\"santander\")) contaCorrente = \"Santander\";\n        else if (maquininha.includes(\"topazio\") || maquininha.includes(\"topázio\")) contaCorrente = \"Banco Topázio\";\n    }\n\n    // --- 4. SEPARAÇÃO ERRO VS SUCESSO ---\n    if (categoriaReceber === \"A DEFINIR\" || contaCorrente === \"A DEFINIR\") {\n        \n        let motivoErro = [];\n        if (categoriaReceber === \"A DEFINIR\") motivoErro.push(\"Categoria não identificada\");\n        if (contaCorrente === \"A DEFINIR\") motivoErro.push(\"Conta não identificada\");\n\n        // Adiciona à lista de erros (sem somar)\n        errorItems.push({\n            json: {\n                \"TIPO_RESULTADO\": \"ERRO\", \n                \"STATUS_PROCESSAMENTO\": \"ERRO\",\n                \"MOTIVO_ERRO\": motivoErro.join(\" E \"),\n                \"DEBUG_INFO\": `Produto: '${produtoRaw}' | Maquininha: '${maquininhaRaw}' | Bandeira: '${bandeiraRaw}'`,\n                ...json \n            }\n        });\n\n    } else {\n        // --- 5. AGRUPAMENTO (SUCESSO) ---\n        const uniqueKey = `${rawDate}|${categoriaReceber}|${contaCorrente}`;\n\n        if (!groupedData[uniqueKey]) {\n            groupedData[uniqueKey] = {\n                data: rawDate,\n                catReceber: categoriaReceber,\n                conta: contaCorrente,\n                totalBruto: 0,\n                totalLiquido: 0,\n                totalMdr: 0\n            };\n        }\n        \n        groupedData[uniqueKey].totalBruto += rawValBruto;\n        groupedData[uniqueKey].totalLiquido += rawValLiquido;\n        groupedData[uniqueKey].totalMdr += rawValMdr;\n    }\n}\n\n// --- 6. UNIFICAÇÃO DO OUTPUT ---\n\n// Transforma os agrupados em formato n8n\nconst successOutput = Object.values(groupedData).map(group => {\n    return {\n        json: {\n            \"TIPO_RESULTADO\": \"SUCESSO\",\n            \"Data\": group.data,\n            \"CATEGORIA_A_PAGAR\": \"Juros sobre maquininha de cartão\",\n            \"CATEGORIA_A_RECEBER\": group.catReceber,\n            \"CONTA_CORRENTE\": group.conta,\n            \"Valor Total\": formatCurrency(group.totalBruto),\n            \"Valor Liquido\": formatCurrency(group.totalLiquido),\n            \"Valor Desconto MDR\": formatCurrency(group.totalMdr)\n        }\n    };\n});\n\n// Junta tudo em uma única lista plana (Array de objetos)\nconst finalOutput = [...successOutput, ...errorItems];\n\nreturn finalOutput;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          272,
          -736
        ],
        "id": "15518bfd-5c02-411d-859a-45058e71df60",
        "name": "Code in JavaScript"
      },
      {
        "parameters": {
          "content": "## gerar saídas prontas para serem lançadas no arquivo",
          "height": 464,
          "width": 288
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          192,
          -928
        ],
        "id": "d824e136-fff4-4ddb-b918-6f85edb0d8d6",
        "name": "Sticky Note7"
      },
      {
        "parameters": {
          "operation": "copy",
          "fileId": {
            "__rl": true,
            "value": "1NR3iLkFLRh-HKWs09GG4tLee-ahrcFl79TSmAcgxLlQ",
            "mode": "list",
            "cachedResultName": "Omie_Contas_Pagar_v1_1_5",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NR3iLkFLRh-HKWs09GG4tLee-ahrcFl79TSmAcgxLlQ/edit?usp=drivesdk"
          },
          "name": "=OMIE contas a PAGAR - {{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }} - {{ $now.format('dd-MM-yyyy') }}",
          "sameFolder": false,
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "folderId": {
            "__rl": true,
            "value": "1_WVesCqzjc0eVw9ktk8HuoGFGsJh493P",
            "mode": "id"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          176,
          -1088
        ],
        "id": "f90762af-772a-4033-b98f-ebb6b8213097",
        "name": "COPIA CONTAS A PAGAR",
        "executeOnce": true,
        "alwaysOutputData": false,
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "tHbNUSv81dsDoIWb",
            "name": "Kybernan-BPO"
          }
        }
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineAll",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          1008,
          -736
        ],
        "id": "8d3130f5-48be-4608-b114-173e1b567de5",
        "name": "Merge"
      },
      {
        "parameters": {
          "operation": "copy",
          "fileId": {
            "__rl": true,
            "value": "1Fbbyzp6O4xIqb4cL_6I4Ijd23H5i72XyBRFuKXqo4VA",
            "mode": "list",
            "cachedResultName": "Omie_Contas_Receber_v1_0_6",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1Fbbyzp6O4xIqb4cL_6I4Ijd23H5i72XyBRFuKXqo4VA/edit?usp=drivesdk"
          },
          "name": "=OMIE contas a RECEBER - {{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }} - {{ $now.format('dd-MM-yyyy') }}",
          "sameFolder": false,
          "driveId": {
            "__rl": true,
            "mode": "list",
            "value": "My Drive"
          },
          "folderId": {
            "__rl": true,
            "value": "1_WVesCqzjc0eVw9ktk8HuoGFGsJh493P",
            "mode": "id"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          384,
          -1088
        ],
        "id": "df9b3ed8-8801-4448-aad0-b0cb3e076334",
        "name": "COPIA CONTAS A RECEBER",
        "executeOnce": true,
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "tHbNUSv81dsDoIWb",
            "name": "Kybernan-BPO"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "a28f997a-b036-4ba3-b124-d310546917cb",
                "leftValue": "={{ $json.TIPO_RESULTADO }}",
                "rightValue": "SUCESSO",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          560,
          -736
        ],
        "id": "34a316dc-b0e1-473c-931e-c3b0a10d2e32",
        "name": "ERRO?"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "={{ $('COPIA CONTAS A PAGAR').item.json.id }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Omie_Contas_Pagar",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Categoria *": "={{ $json.CATEGORIA_A_PAGAR }}",
              "Fornecedor * (Razão Social, Nome Fantasia, CNPJ ou CPF)": "MERAKI CAFETERIA LTDA",
              "Conta Corrente *": "={{ $json.CONTA_CORRENTE }}",
              "Valor da Conta *": "={{ $json['Valor Total'] }}",
              "Data de Emissão": "={{ $json.Data }}",
              "Data de Registro *": "={{ $json.Data }}",
              "Data de Vencimento *": "={{ $json.Data }}",
              "Data de Previsão": "={{ $json.Data }}",
              "Data do Pagamento": "={{ $json.Data }}",
              "Valor do Pagamento": "={{ $json['Valor Total'] }}",
              "Data de Conciliação": "={{ $json.Data }}",
              "row_number": "={{ $json.codigo }}"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "Código de Integração",
                "displayName": "Código de Integração",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Fornecedor * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
                "displayName": "Fornecedor * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Categoria *",
                "displayName": "Categoria *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Conta Corrente *",
                "displayName": "Conta Corrente *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Valor da Conta *",
                "displayName": "Valor da Conta *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Vendedor",
                "displayName": "Vendedor",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Projeto",
                "displayName": "Projeto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Data de Emissão",
                "displayName": "Data de Emissão",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data de Registro *",
                "displayName": "Data de Registro *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data de Vencimento *",
                "displayName": "Data de Vencimento *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data de Previsão",
                "displayName": "Data de Previsão",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data do Pagamento",
                "displayName": "Data do Pagamento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Valor do Pagamento",
                "displayName": "Valor do Pagamento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Juros",
                "displayName": "Juros",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Multa",
                "displayName": "Multa",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Desconto",
                "displayName": "Desconto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Data de Conciliação",
                "displayName": "Data de Conciliação",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Observações",
                "displayName": "Observações",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Tipo de Documento",
                "displayName": "Tipo de Documento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Número do Documento",
                "displayName": "Número do Documento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Parcela",
                "displayName": "Parcela",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Total de Parcelas",
                "displayName": "Total de Parcelas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Número do Pedido",
                "displayName": "Número do Pedido",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nota Fiscal",
                "displayName": "Nota Fiscal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Chave da NF-e",
                "displayName": "Chave da NF-e",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Forma de Pagamento",
                "displayName": "Forma de Pagamento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Código de Barras do Boleto",
                "displayName": "Código de Barras do Boleto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "% de Juros ao Mês do Boleto",
                "displayName": "% de Juros ao Mês do Boleto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "% de Multa por Atraso do Boleto",
                "displayName": "% de Multa por Atraso do Boleto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Banco da Transferência",
                "displayName": "Banco da Transferência",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Agência da Transferência",
                "displayName": "Agência da Transferência",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Conta Corrente da Transferência",
                "displayName": "Conta Corrente da Transferência",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "CNPJ ou CPF do Titular",
                "displayName": "CNPJ ou CPF do Titular",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nome do Titular da Conta",
                "displayName": "Nome do Titular da Conta",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Finalidade da Transferência",
                "displayName": "Finalidade da Transferência",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Chave Pix",
                "displayName": "Chave Pix",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor PIS",
                "displayName": "Valor PIS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter PIS",
                "displayName": "Reter PIS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor COFINS",
                "displayName": "Valor COFINS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter COFINS",
                "displayName": "Reter COFINS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor CSLL",
                "displayName": "Valor CSLL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter CSLL",
                "displayName": "Reter CSLL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor IR",
                "displayName": "Valor IR",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter IR",
                "displayName": "Reter IR",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor ISS",
                "displayName": "Valor ISS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter ISS",
                "displayName": "Reter ISS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor INSS",
                "displayName": "Valor INSS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter INSS",
                "displayName": "Reter INSS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Departamento (100%)",
                "displayName": "Departamento (100%)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Número da NF (serviço tomado)",
                "displayName": "Número da NF (serviço tomado)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Série",
                "displayName": "Série",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Código do Serviço (LC116)",
                "displayName": "Código do Serviço (LC116)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor total da NF",
                "displayName": "Valor total da NF",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "CST do PIS",
                "displayName": "CST do PIS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Base de Cálculo - PIS",
                "displayName": "Base de Cálculo - PIS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Alíquota do PIS (%)",
                "displayName": "Alíquota do PIS (%)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor do PIS",
                "displayName": "Valor do PIS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "CST do COFINS",
                "displayName": "CST do COFINS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Base de cálculo - COFINS",
                "displayName": "Base de cálculo - COFINS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Alíquota  do COFINS (%)",
                "displayName": "Alíquota  do COFINS (%)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor do COFINS",
                "displayName": "Valor do COFINS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {
            "locationDefine": {
              "values": {
                "headerRow": 5,
                "firstDataRow": 6
              }
            }
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2752,
          -464
        ],
        "id": "6ad8cfe5-8cdb-4d79-a13d-ae17f9add742",
        "name": "ATUALIZA CONTAS A PAGAR",
        "executeOnce": false,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "vwb992tcodcaklq5",
            "name": "KyberTech"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "671a3362-c31a-41bc-a551-40c4614eab40",
                "leftValue": "={{ $json.CATEGORIA_A_RECEBER }}",
                "rightValue": "Recebimento por Maquininha TICKET",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          1232,
          -736
        ],
        "id": "13e60a9e-b78d-44f4-ad1e-a2b0cf124088",
        "name": "voucher / ticket",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "operation": "download",
          "fileId": {
            "__rl": true,
            "value": "={{ $('COPIA CONTAS A PAGAR').item.json.id }}",
            "mode": "id"
          },
          "options": {
            "binaryPropertyName": "data",
            "googleFileConversion": {
              "conversion": {
                "docsToFormat": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                "sheetsToFormat": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
              }
            },
            "fileName": "={{ $('COPIA CONTAS A PAGAR').item.json.name }}.xlsx"
          }
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          3024,
          -464
        ],
        "id": "6b3a483b-3eaa-49ac-9df2-8a08f9e8a21a",
        "name": "Download file",
        "executeOnce": true,
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "tHbNUSv81dsDoIWb",
            "name": "Kybernan-BPO"
          }
        }
      },
      {
        "parameters": {
          "operation": "sendDocument",
          "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
          "binaryData": true,
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          3248,
          -464
        ],
        "id": "2fd9cd62-7140-423f-9aa5-e85c0d8da5e1",
        "name": "Send a document",
        "webhookId": "08b0fb0a-7902-40b7-b930-b5bd95042da8",
        "credentials": {
          "telegramApi": {
            "id": "jciBUUGqi15C8nzu",
            "name": "CONCILIADOR FINANCEIRO KYBERNAN"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "2bdb95e5-ac35-4892-b19b-04ccc68e9b9a",
                "name": "Data",
                "value": "={{ $json.Data }}",
                "type": "string"
              },
              {
                "id": "499638e4-8a13-4ed0-a690-76fd06b4198d",
                "name": "CATEGORIA_A_PAGAR",
                "value": "={{ $json.CATEGORIA_A_PAGAR }}",
                "type": "string"
              },
              {
                "id": "d90a9d69-868d-4e5b-8c73-7d5dc93acb5a",
                "name": "CONTA_CORRENTE",
                "value": "={{ $json.CONTA_CORRENTE }}",
                "type": "string"
              },
              {
                "id": "bf9da488-de06-418e-8283-6b9c83b67a99",
                "name": "Valor Desconto MDR",
                "value": "={{ $json['Valor Desconto MDR'] }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2016,
          -416
        ],
        "id": "f3dcde25-5ba2-4f80-a90a-4b80436bef43",
        "name": "Edit Fields4"
      },
      {
        "parameters": {
          "jsCode": "// Mapeia a entrada para pegar apenas o JSON de cada item\nconst inputData = items.map(item => item.json);\n\nconst sums = {};\nconst finalItems = [];\n\n// 1. ITERAÇÃO E AGRUPAMENTO\ninputData.forEach((item, index) => {\n  try {\n    // --- Validação básica ---\n    if (!item[\"Data\"]) throw new Error(\"Campo 'Data' ausente.\");\n    \n    // Pegamos os valores auxiliares para repassar ao output\n    const categoria = item[\"CATEGORIA_A_PAGAR\"] || \"\";\n    const conta = item[\"CONTA_CORRENTE\"] || \"\";\n\n    if (item[\"Valor Desconto MDR\"] === undefined) throw new Error(\"Campo 'Valor Desconto MDR' ausente.\");\n\n    const data = item[\"Data\"];\n    const valorRaw = item[\"Valor Desconto MDR\"];\n    let valorFloat = 0.0;\n\n    // --- Tratamento de string/número ---\n    if (typeof valorRaw === 'string') {\n      const cleanValue = valorRaw.trim().replace(',', '.');\n      valorFloat = parseFloat(cleanValue);\n    } else if (typeof valorRaw === 'number') {\n      valorFloat = valorRaw;\n    } else {\n      throw new Error(`Formato desconhecido.`);\n    }\n\n    if (isNaN(valorFloat)) {\n      throw new Error(`Valor inválido: '${valorRaw}'`);\n    }\n\n    // --- Lógica de Agrupamento ---\n    if (!sums[data]) {\n      sums[data] = {\n        total: 0.0,\n        categoria: categoria,\n        conta: conta\n      };\n    }\n    \n    sums[data].total += valorFloat;\n\n  } catch (err) {\n    // SE DER ERRO: Adiciona à lista final como erro\n    finalItems.push({\n      json: {\n        tipo: \"ERRO\",\n        mensagem: err.message,\n        linha_original: index + 1,\n        dados_input: item\n      }\n    });\n  }\n});\n\n// 2. FORMATAÇÃO DOS SUCESSOS\nObject.keys(sums).forEach(data => {\n  const info = sums[data];\n\n  finalItems.push({\n    json: {\n      tipo: \"SUCESSO\",\n      \"Data\": data,\n      \"CATEGORIA_A_PAGAR\": info.categoria,\n      \"CONTA_CORRENTE\": info.conta,\n      \"Valor Total\": info.total.toFixed(2).replace('.', ',')\n    }\n  });\n});\n\n// 3. GERAÇÃO DO CÓDIGO SEQUENCIAL (APENAS SE FOR SUCESSO)\nlet contadorCodigo = 6;\n\nfinalItems.forEach(item => {\n    // Só adiciona o código se o tipo for SUCESSO\n    if (item.json.tipo === \"SUCESSO\") {\n        item.json.codigo = contadorCodigo;\n        contadorCodigo++; // Só incrementa se usou o número\n    }\n});\n\n// 4. RETORNO\nreturn finalItems;"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2240,
          -416
        ],
        "id": "7477999c-14f2-4a50-a3db-4030fd8b2a91",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineAll",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          2528,
          -464
        ],
        "id": "9c1f0825-b967-496b-8076-22a9f8f564de",
        "name": "Merge1"
      },
      {
        "parameters": {
          "mode": "chooseBranch",
          "output": "empty"
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          2368,
          -944
        ],
        "id": "ac69ea04-5573-44f7-84c0-a24b1b4f0712",
        "name": "Merge2"
      },
      {
        "parameters": {
          "operation": "download",
          "fileId": {
            "__rl": true,
            "value": "={{ $('COPIA CONTAS A RECEBER').item.json.id }}",
            "mode": "id"
          },
          "options": {
            "binaryPropertyName": "data",
            "googleFileConversion": {
              "conversion": {
                "docsToFormat": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                "sheetsToFormat": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
              }
            },
            "fileName": "={{ $('COPIA CONTAS A RECEBER').item.json.name }}.xlsx"
          }
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          2640,
          -944
        ],
        "id": "2e031a12-0251-4ffc-b222-7bd7fa3416e7",
        "name": "Download file1",
        "executeOnce": true,
        "credentials": {
          "googleDriveOAuth2Api": {
            "id": "tHbNUSv81dsDoIWb",
            "name": "Kybernan-BPO"
          }
        }
      },
      {
        "parameters": {
          "operation": "sendDocument",
          "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
          "binaryData": true,
          "additionalFields": {}
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          2864,
          -944
        ],
        "id": "0e4c76e1-15aa-4ade-9498-8a0af9e8e3fc",
        "name": "Send a document1",
        "webhookId": "08b0fb0a-7902-40b7-b930-b5bd95042da8",
        "credentials": {
          "telegramApi": {
            "id": "jciBUUGqi15C8nzu",
            "name": "CONCILIADOR FINANCEIRO KYBERNAN"
          }
        }
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "={{ $('COPIA CONTAS A RECEBER').item.json.id }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Omie_Contas_Receber",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "row_number": "={{ $json.codigo }}",
              "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)": "MERAKI CAFETERIA LTDA",
              "Categoria *": "={{ $json.CATEGORIA_A_RECEBER }}",
              "Conta Corrente *": "={{ $json.CONTA_CORRENTE }}",
              "Valor da Conta *": "={{ $json['Valor Liquido'] }}",
              "Data de Emissão": "={{ $json.Data }}",
              "Data de Registro *": "={{ $json.Data }}",
              "Data de Vencimento *": "={{ $json.Data }}",
              "Data de Previsão": "={{ $json.Data }}",
              "Data do Recebimento": "={{ $json.Data }}",
              "Valor do Recebimento": "={{ $json['Valor Liquido'] }}",
              "Data de Conciliação": "={{ $json.Data }}"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "Código de Integração",
                "displayName": "Código de Integração",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
                "displayName": "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Categoria *",
                "displayName": "Categoria *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Conta Corrente *",
                "displayName": "Conta Corrente *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Valor da Conta *",
                "displayName": "Valor da Conta *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Vendedor",
                "displayName": "Vendedor",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Projeto",
                "displayName": "Projeto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Data de Emissão",
                "displayName": "Data de Emissão",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data de Registro *",
                "displayName": "Data de Registro *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data de Vencimento *",
                "displayName": "Data de Vencimento *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data de Previsão",
                "displayName": "Data de Previsão",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data do Recebimento",
                "displayName": "Data do Recebimento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Valor do Recebimento",
                "displayName": "Valor do Recebimento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Juros",
                "displayName": "Juros",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Multa",
                "displayName": "Multa",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Desconto",
                "displayName": "Desconto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Data de Conciliação",
                "displayName": "Data de Conciliação",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Observações",
                "displayName": "Observações",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Tipo de Documento",
                "displayName": "Tipo de Documento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Número do Documento",
                "displayName": "Número do Documento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Parcela",
                "displayName": "Parcela",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Total de Parcelas",
                "displayName": "Total de Parcelas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Número do Pedido",
                "displayName": "Número do Pedido",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nota Fiscal",
                "displayName": "Nota Fiscal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Chave da NF-e",
                "displayName": "Chave da NF-e",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Código de Barras",
                "displayName": "Código de Barras",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Número do Boleto",
                "displayName": "Número do Boleto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "NSU / TID",
                "displayName": "NSU / TID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor PIS",
                "displayName": "Valor PIS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter PIS",
                "displayName": "Reter PIS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor COFINS",
                "displayName": "Valor COFINS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter COFINS",
                "displayName": "Reter COFINS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor CSLL",
                "displayName": "Valor CSLL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter CSLL",
                "displayName": "Reter CSLL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor IR",
                "displayName": "Valor IR",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter IR",
                "displayName": "Reter IR",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor ISS",
                "displayName": "Valor ISS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter ISS",
                "displayName": "Reter ISS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor INSS",
                "displayName": "Valor INSS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter INSS",
                "displayName": "Reter INSS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Departamento (100%)",
                "displayName": "Departamento (100%)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {
            "locationDefine": {
              "values": {
                "headerRow": 5,
                "firstDataRow": 6
              }
            }
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2000,
          -1168
        ],
        "id": "3a82473b-2a8f-446c-8453-b2c8f807a5c0",
        "name": "ATUALIZA CONTAS A RECEBER2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "vwb992tcodcaklq5",
            "name": "KyberTech"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "ffefbe4a-be53-4288-9c0e-e451e0a8d6a3",
                "name": "codigo",
                "value": "={{ $itemIndex + 6 }}",
                "type": "string"
              },
              {
                "id": "b85346af-6438-4756-bbe2-3dcf69187791",
                "name": "Data",
                "value": "={{ $json.Data }}",
                "type": "string"
              },
              {
                "id": "6e6e1210-e61b-41f5-9a2d-e80f636a0912",
                "name": "CATEGORIA_A_PAGAR",
                "value": "={{ $json.CATEGORIA_A_PAGAR }}",
                "type": "string"
              },
              {
                "id": "65e83ee6-9765-4eba-b9da-03d55e308fe5",
                "name": "CATEGORIA_A_RECEBER",
                "value": "={{ $json.CATEGORIA_A_RECEBER }}",
                "type": "string"
              },
              {
                "id": "97189c39-6040-4443-8e4e-86c86bf3d32f",
                "name": "CONTA_CORRENTE",
                "value": "={{ $json.CONTA_CORRENTE }}",
                "type": "string"
              },
              {
                "id": "7e192e96-04dc-49fb-869f-1baf22953187",
                "name": "Valor Total",
                "value": "={{ $json['Valor Total'] }}",
                "type": "string"
              },
              {
                "id": "e076bc9d-4121-4de0-8a5e-4ffc3a2ce3ad",
                "name": "Valor Liquido",
                "value": "={{ $json['Valor Liquido'] }}",
                "type": "string"
              },
              {
                "id": "31bc6a0e-344f-4f15-a26e-3ad2d8cdb725",
                "name": "Valor Desconto MDR",
                "value": "={{ $json['Valor Desconto MDR'] }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1616,
          -1072
        ],
        "id": "c01118fe-87a8-495f-9a3f-14cec1068c0a",
        "name": "Edit Fields5"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "={{ $('COPIA CONTAS A RECEBER').item.json.id }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "Omie_Contas_Receber",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "row_number": "={{ $json.codigo }}",
              "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)": "MERAKI CAFETERIA LTDA",
              "Categoria *": "={{ $json.CATEGORIA_A_RECEBER }}",
              "Conta Corrente *": "={{ $json.CONTA_CORRENTE }}",
              "Valor da Conta *": "={{ $json['Valor Total'] }}",
              "Data de Emissão": "={{ $json.Data }}",
              "Data de Registro *": "={{ $json.Data }}",
              "Data de Vencimento *": "={{ $json.Data }}",
              "Data de Previsão": "={{ $json.Data }}",
              "Data do Recebimento": "={{ $json.Data }}",
              "Valor do Recebimento": "={{ $json['Valor Total'] }}",
              "Data de Conciliação": "={{ $json.Data }}"
            },
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "Código de Integração",
                "displayName": "Código de Integração",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
                "displayName": "Cliente * (Razão Social, Nome Fantasia, CNPJ ou CPF)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Categoria *",
                "displayName": "Categoria *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Conta Corrente *",
                "displayName": "Conta Corrente *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Valor da Conta *",
                "displayName": "Valor da Conta *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Vendedor",
                "displayName": "Vendedor",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Projeto",
                "displayName": "Projeto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Data de Emissão",
                "displayName": "Data de Emissão",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data de Registro *",
                "displayName": "Data de Registro *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data de Vencimento *",
                "displayName": "Data de Vencimento *",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data de Previsão",
                "displayName": "Data de Previsão",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Data do Recebimento",
                "displayName": "Data do Recebimento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Valor do Recebimento",
                "displayName": "Valor do Recebimento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Juros",
                "displayName": "Juros",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Multa",
                "displayName": "Multa",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Desconto",
                "displayName": "Desconto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Data de Conciliação",
                "displayName": "Data de Conciliação",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Observações",
                "displayName": "Observações",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Tipo de Documento",
                "displayName": "Tipo de Documento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Número do Documento",
                "displayName": "Número do Documento",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Parcela",
                "displayName": "Parcela",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Total de Parcelas",
                "displayName": "Total de Parcelas",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Número do Pedido",
                "displayName": "Número do Pedido",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Nota Fiscal",
                "displayName": "Nota Fiscal",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Chave da NF-e",
                "displayName": "Chave da NF-e",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Código de Barras",
                "displayName": "Código de Barras",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Número do Boleto",
                "displayName": "Número do Boleto",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "NSU / TID",
                "displayName": "NSU / TID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor PIS",
                "displayName": "Valor PIS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter PIS",
                "displayName": "Reter PIS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor COFINS",
                "displayName": "Valor COFINS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter COFINS",
                "displayName": "Reter COFINS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor CSLL",
                "displayName": "Valor CSLL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter CSLL",
                "displayName": "Reter CSLL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor IR",
                "displayName": "Valor IR",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter IR",
                "displayName": "Reter IR",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor ISS",
                "displayName": "Valor ISS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter ISS",
                "displayName": "Reter ISS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Valor INSS",
                "displayName": "Valor INSS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Reter INSS",
                "displayName": "Reter INSS",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "Departamento (100%)",
                "displayName": "Departamento (100%)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {
            "locationDefine": {
              "values": {
                "headerRow": 5,
                "firstDataRow": 6
              }
            }
          }
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2192,
          -784
        ],
        "id": "4a1eca1b-376b-482a-b36d-988c87f4bf27",
        "name": "ATUALIZA CONTAS A RECEBER3",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "vwb992tcodcaklq5",
            "name": "KyberTech"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c6659db5-6047-43b5-a528-d16be2ca391c",
                "name": "codigo",
                "value": "={{ $('Edit Fields5').last().json.codigo }}",
                "type": "number"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1808,
          -992
        ],
        "id": "f2fa2428-ac94-4824-9f09-f297156aefd1",
        "name": "Edit Fields7",
        "executeOnce": true
      },
      {
        "parameters": {
          "mode": "combine",
          "combineBy": "combineAll",
          "options": {}
        },
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3.2,
        "position": [
          1824,
          -784
        ],
        "id": "2236114c-0cb2-437d-a14f-070582f3dd49",
        "name": "Merge3"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c20cfa37-7640-416b-8277-8853c20df0cf",
                "name": "Data",
                "value": "={{ $json.Data }}",
                "type": "string"
              },
              {
                "id": "d55da94c-132c-4888-888d-a6803fcf9692",
                "name": "CATEGORIA_A_PAGAR",
                "value": "={{ $json.CATEGORIA_A_PAGAR }}",
                "type": "string"
              },
              {
                "id": "96401f77-f04d-4b38-bc6e-04d67cd22676",
                "name": "CATEGORIA_A_RECEBER",
                "value": "={{ $json.CATEGORIA_A_RECEBER }}",
                "type": "string"
              },
              {
                "id": "8bc6fa7a-ee87-425e-bdc8-3a18e02c5d1e",
                "name": "CONTA_CORRENTE",
                "value": "={{ $json.CONTA_CORRENTE }}",
                "type": "string"
              },
              {
                "id": "898175be-7402-4ebf-847e-73f4eba0754d",
                "name": "Valor Total",
                "value": "={{ $json['Valor Total'] }}",
                "type": "string"
              },
              {
                "id": "7e593959-aa41-48db-b08e-a70af50d30da",
                "name": "Valor Liquido",
                "value": "={{ $json['Valor Liquido'] }}",
                "type": "string"
              },
              {
                "id": "3d3ddef5-1a60-423d-818b-93fadc6da907",
                "name": "Valor Desconto MDR",
                "value": "={{ $json['Valor Desconto MDR'] }}",
                "type": "string"
              },
              {
                "id": "bfd0890c-5cf6-44ad-9e44-e056808d20a1",
                "name": "codigo",
                "value": "={{ $itemIndex + 1 + ($('Edit Fields7').isExecuted ? $('Edit Fields7').item.json.codigo : 5) }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2000,
          -784
        ],
        "id": "80f7f73b-648c-47b6-98ea-5a19679212b0",
        "name": "Edit Fields8"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "d4c6dc0b-165e-45ca-a0ec-c8249965cd2a",
                "leftValue": "={{ $json }}",
                "rightValue": "",
                "operator": {
                  "type": "object",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          1360,
          -1056
        ],
        "id": "15c635a8-fa1b-4331-ace1-0199a1581bd6",
        "name": "If"
      },
      {
        "parameters": {
          "operation": "xlsx",
          "binaryPropertyName": "={{ $('Telegram Trigger').item.binary.data }}",
          "options": {
            "headerRow": true,
            "range": "7"
          }
        },
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1.1,
        "position": [
          -912,
          -592
        ],
        "id": "358cb101-415e-4de0-90d6-0441b5e5c687",
        "name": "Extract from File3"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "97a88027-fb5b-4f04-b307-bd794daf3b83",
                "name": "DATA DA VENDA",
                "value": "={{ $json['DATA/HORA DA VENDA'].split(' ')[0] }}",
                "type": "string"
              },
              {
                "id": "2acc3632-75e2-457a-8053-d0d4113aa1f4",
                "name": "PRODUTO",
                "value": "={{ $json.MODALIDADE }}",
                "type": "string"
              },
              {
                "id": "e35c48e8-5eec-4889-8f1d-f903f44c57c2",
                "name": "VALOR BRUTO",
                "value": "={{ $json['VALOR BRUTO'] }}",
                "type": "number"
              },
              {
                "id": "e35ebb0b-8f5e-4537-9f7f-8318fa25a71f",
                "name": "VALOR LIQUIDO",
                "value": "={{ $json['VALOR LÍQUIDO'] }}",
                "type": "number"
              },
              {
                "id": "a0c1019d-6978-4fc0-8cb0-6c9b0de1703d",
                "name": "DESCONTO DE MDR",
                "value": "={{ $json['VALOR TAXA'] }}",
                "type": "number"
              },
              {
                "id": "25feee2d-d497-45b9-b6ef-19ec479bf499",
                "name": "ULTIMO STATUS",
                "value": "={{ $json['STATUS DA TRANSAÇÃO'] }}",
                "type": "string"
              },
              {
                "id": "1daa56c0-1798-4869-96d6-c51575ae735c",
                "name": "BANDEIRA",
                "value": "={{ $json.BANDEIRA }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -704,
          -592
        ],
        "id": "e8254324-bc1c-4d3e-9dd1-a437b45c93f0",
        "name": "Edit Fields6"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "69644f4c-051e-407f-9a6c-1c2c182c5e8d",
                "leftValue": "={{ $json['ULTIMO STATUS'] }}",
                "rightValue": "Aprovada",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "13bcb585-b4d2-42c6-8349-427fd57debbf",
                "leftValue": "={{ $json['ULTIMO STATUS'] }}",
                "rightValue": "aprovado",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -48,
          -720
        ],
        "id": "4914939d-338c-47c6-89ff-ee23ab642a1d",
        "name": "aprovada?"
      },
      {
        "parameters": {
          "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
          "text": "=Encontrei {{ $input.all().length }} transações que não foram aprovadas.",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          80,
          -416
        ],
        "id": "b83693eb-dd18-446d-a024-16e9233005d1",
        "name": "Send a text message",
        "webhookId": "08b0fb0a-7902-40b7-b930-b5bd95042da8",
        "executeOnce": true,
        "credentials": {
          "telegramApi": {
            "id": "jciBUUGqi15C8nzu",
            "name": "CONCILIADOR FINANCEIRO KYBERNAN"
          }
        }
      },
      {
        "parameters": {
          "content": "## GERA O ARQUIVO DE OUTPUT DEPENDENDO DO SISTEMA DA EMPRESA SÓ COM O QUE PRECISA SER LANÇADO\n",
          "height": 432
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          768,
          -128
        ],
        "id": "295f0aa7-0e13-4525-a6a7-9fbb308acfc4",
        "name": "Sticky Note3"
      },
      {
        "parameters": {
          "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
          "text": "=Encontrei {{ $input.all().length }} transações que deram erro, avisar Bruno para verificar.",
          "additionalFields": {
            "appendAttribution": false
          }
        },
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          768,
          -560
        ],
        "id": "9f571527-b405-475e-810d-101bfc50c8ec",
        "name": "Send a text message1",
        "webhookId": "08b0fb0a-7902-40b7-b930-b5bd95042da8",
        "executeOnce": true,
        "credentials": {
          "telegramApi": {
            "id": "jciBUUGqi15C8nzu",
            "name": "CONCILIADOR FINANCEIRO KYBERNAN"
          }
        }
      },
      {
        "parameters": {
          "resource": "image",
          "operation": "analyze",
          "modelId": {
            "__rl": true,
            "value": "models/gemini-3-flash-preview",
            "mode": "list",
            "cachedResultName": "models/gemini-3-flash-preview"
          },
          "text": "=# Role (Papel)\n* Analisar a imagem extraindo informações de vendas no crédito, débito e pix.\n\n# Context\n* Em uma imagem vai ter um ou mais relatórios de vendas de maquininha de cartão de crédito da pagseguro com o total de credito, débito e às vezes pix e a data\n\n# Task\n\n## Etapa 1\n* Identifique quantos cupons de relatório tem, cada cupom será de um dia diferente, identifique a data de cada cupom\n\n## Etapa 2\n* Extraia as seguintes informações de cada um dos cupons\n* Data, valor total do credito, valor total do debito, valor total do pix\n* Ignore os subtotais, extraindo apenas os totais de categoria e a data\n\n## Etapa 3\n\n* Apresente os dados extraídos seguindo exatamente este formato para cada cupom identificado:\n\"📊 Relatório de Vendas - [INSERIR DATA]\n\nData: [DD/MM/AAAA]\nCrédito Total: R$ [0,00]\nDébito Total: R$ [0,00]\nPIX Total: R$ [0,00]\"\n\n# Rules\n* Não erre os valores, tenha certeza absoluta de informar as datas e totais corretamente.\n* Analise corretamente a data e o ANO também, para não errar dizendo que é de 2023 sendo que na verdade é de 2026, normalmente a data será de 2025 / 2026 em diante, nunca será 2024 para trás.\n* Nunca confunda o total efetivado com o total de credito, debito ou pix\n* Não extraia o valor de total efetivado, apenas total de credito, debito e pix\n* Tenha certeza ABSOLUTA e confirme que o valor extraído está 100% correto, valor exato, inclusive os centavos, faça um ocr bem feito, um copia e cola exato.\n* NÃO EXTRAIA O TOTAL EFETIVADO.",
          "inputType": "binary",
          "binaryPropertyName": "=data",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.googleGemini",
        "typeVersion": 1.1,
        "position": [
          -704,
          -256
        ],
        "id": "ccd8b7f2-8c72-4f85-9087-5eb85558a171",
        "name": "Analyze an image",
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "maxTries": 2,
        "credentials": {
          "googlePalmApi": {
            "id": "wfEWNV7ZmLlccItk",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "e956ea32-d9c6-4ef4-9c5e-69ae7c03d06b",
                "name": "=data",
                "value": "={{ $('Telegram Trigger').item.binary.data }}",
                "type": "binary"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -912,
          -256
        ],
        "id": "bc6a8e1d-96f1-4e4a-9250-f424699a1624",
        "name": "Edit Fields9"
      },
      {
        "parameters": {
          "text": "={{ $json.content.parts[0].text }}",
          "schemaType": "fromJson",
          "jsonSchemaExample": "[\n  {\n    \"DATA DA VENDA\": \"12/01/2026\",\n    \"PRODUTO\": \"Crédito\",\n    \"VALOR BRUTO\": 1680.75,\n    \"ULTIMO STATUS\": \"Aprovado\"\n  },\n  {\n    \"DATA DA VENDA\": \"12/01/2026\",\n    \"PRODUTO\": \"Débito\",\n    \"VALOR BRUTO\": 85.00,\n    \"ULTIMO STATUS\": \"Aprovado\"\n  },\n  {\n    \"DATA DA VENDA\": \"12/01/2026\",\n    \"PRODUTO\": \"Pix\",\n    \"VALOR BRUTO\": 210.00,\n    \"ULTIMO STATUS\": \"Concluído\"\n  }\n]",
          "options": {
            "systemPromptTemplate": "=# Prompt\n\n**Papel:**\nVocê é um algoritmo especialista em extração de dados e processamento de documentos fiscais e relatórios de vendas. Sua tarefa é analisar o texto/imagem e converter as informações em um formato estruturado JSON.\n\n**Diretrizes de Extração:**\n\n1. **Foco:** Extraia apenas as informações relevantes solicitadas. Se não encontrar o valor de um atributo, omita o campo ou retorne nulo.\n2. **Regra do PIX:** Só extraia a categoria \"PIX\" se o valor total for maior que zero. Se for zero, ignore essa entrada.\n3. **Status Fixo:** O campo `ULTIMO STATUS` deve ser sempre preenchido como `\"aprovado\"`.\n4. **Não Agregação:** Não some os valores de diferentes tipos de transação e datas. Cada tipo de produto e data deve ter sua própria entrada no array.\n\n**Estrutura de Saída:**\nGere um **array de objetos** onde a data deve ser repetida para cada tipo de produto encontrado no relatório. Os valores permitidos para o campo `PRODUTO` são apenas: `\"credito\"`, `\"debito\"` ou `\"PIX\"`."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.informationExtractor",
        "typeVersion": 1.2,
        "position": [
          -912,
          -16
        ],
        "id": "45ca0d75-71d0-42a1-ab46-f2e1eb635e28",
        "name": "Information Extractor"
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4.1-mini"
          },
          "builtInTools": {},
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.3,
        "position": [
          -864,
          160
        ],
        "id": "8327a409-a703-4d7f-bd37-e3ab05c446e5",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "fRrIyxCKgTlReSWb",
            "name": "Kybernan-Arquivador"
          }
        }
      },
      {
        "parameters": {
          "fieldToSplitOut": "output",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -608,
          -16
        ],
        "id": "1022c66a-9541-410f-b724-ea2b4e873971",
        "name": "Split Out"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "970c8fe2-1695-4dd0-8073-61fb7cd0f8c1",
                "name": "DATA DA VENDA",
                "value": "={{ $json['DATA DA VENDA'] }}",
                "type": "string"
              },
              {
                "id": "52499be6-ad8e-4a03-92e1-056d7bbe32b2",
                "name": "PRODUTO",
                "value": "={{ $json.PRODUTO }}",
                "type": "string"
              },
              {
                "id": "85bb24c5-b4d1-4799-90d3-8c3da56e287b",
                "name": "VALOR BRUTO",
                "value": "={{ $json['VALOR BRUTO'] }}",
                "type": "number"
              },
              {
                "id": "5ff4548e-af5f-4d0d-a0e0-16000fbd3d28",
                "name": "VALOR LIQUIDO",
                "value": "={{ $json['VALOR BRUTO'] - (['credito', 'crédito'].includes($json.PRODUTO.toLowerCase()) ? $json['VALOR BRUTO'] * 0.055 : $json['VALOR BRUTO'] * 0.045).toFixed(2) }}",
                "type": "number"
              },
              {
                "id": "13a59c9c-049d-4651-aa65-a333e0e21534",
                "name": "DESCONTO DE MDR",
                "value": "={{ (['credito', 'crédito'].includes($json.PRODUTO.toLowerCase()) ? $json['VALOR BRUTO'] * 0.055 : $json['VALOR BRUTO'] * 0.045).toFixed(2) }}",
                "type": "number"
              },
              {
                "id": "3ef36e11-ee76-4fea-8ae5-2c6efd38d8ec",
                "name": "ULTIMO STATUS",
                "value": "={{ $json['ULTIMO STATUS'] }}",
                "type": "string"
              },
              {
                "id": "ecded5dc-749b-4191-8270-78e88c4bef2f",
                "name": "MAQUININHA",
                "value": "={{ $('Send message and wait for response1').item.json.data['Qual maquininha?'] }}",
                "type": "string"
              },
              {
                "id": "07af5b79-9b3e-4c20-b4be-027bad61f814",
                "name": "data['Qual empresa?']",
                "value": "={{ $('Send message and wait for response1').item.json.data['Qual empresa?'] }}",
                "type": "string"
              },
              {
                "id": "7fab4c36-6f4c-4f42-8c65-2139d58938f8",
                "name": "BANDEIRA",
                "value": "={{ $json.PRODUTO }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -400,
          -240
        ],
        "id": "3a203f49-41b3-4102-8b07-3f59c279e6d0",
        "name": "Edit Fields10"
      }
    ],
    "connections": {
      "Telegram Trigger": {
        "main": [
          [
            {
              "node": "Send message and wait for response1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s)": {
        "main": [
          []
        ]
      },
      "Extract from File": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send message and wait for response1": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Extract from File",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Extract from File1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Extract from File3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Extract from File2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract from File1": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract from File2": {
        "main": [
          [
            {
              "node": "Edit Fields2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields2": {
        "main": [
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields3": {
        "main": [
          [
            {
              "node": "COPIA CONTAS A PAGAR",
              "type": "main",
              "index": 0
            },
            {
              "node": "aprovada?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "ERRO?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "COPIA CONTAS A PAGAR": {
        "main": [
          [
            {
              "node": "COPIA CONTAS A RECEBER",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "voucher / ticket",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "COPIA CONTAS A RECEBER": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ERRO?": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ],
          [
            {
              "node": "Send a text message1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ATUALIZA CONTAS A PAGAR": {
        "main": [
          [
            {
              "node": "Download file",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "voucher / ticket": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields4",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge3",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Download file": {
        "main": [
          [
            {
              "node": "Send a document",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields4": {
        "main": [
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "Merge1",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge1": {
        "main": [
          [
            {
              "node": "ATUALIZA CONTAS A PAGAR",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Download file1": {
        "main": [
          [
            {
              "node": "Send a document1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge2": {
        "main": [
          [
            {
              "node": "Download file1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ATUALIZA CONTAS A RECEBER2": {
        "main": [
          [
            {
              "node": "Merge2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields5": {
        "main": [
          [
            {
              "node": "ATUALIZA CONTAS A RECEBER2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Edit Fields7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields7": {
        "main": [
          [
            {
              "node": "Merge3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge3": {
        "main": [
          [
            {
              "node": "Edit Fields8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields8": {
        "main": [
          [
            {
              "node": "ATUALIZA CONTAS A RECEBER3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ATUALIZA CONTAS A RECEBER3": {
        "main": [
          [
            {
              "node": "Merge2",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "If": {
        "main": [
          [
            {
              "node": "Edit Fields5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Merge2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Merge3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract from File3": {
        "main": [
          [
            {
              "node": "Edit Fields6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields6": {
        "main": [
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "aprovada?": {
        "main": [
          [
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send a text message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields9": {
        "main": [
          [
            {
              "node": "Analyze an image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze an image": {
        "main": [
          [
            {
              "node": "Information Extractor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "Information Extractor",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Information Extractor": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Edit Fields10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields10": {
        "main": [
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Kybernan Tech",
    "name": "Version 2f3cd67b",
    "description": "",
    "autosaved": false
  },
  "tags": []
}